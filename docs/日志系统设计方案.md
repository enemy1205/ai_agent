# æ™ºèƒ½æœºå™¨äººç³»ç»Ÿ - ç»Ÿä¸€æ—¥å¿—æ–¹æ¡ˆè®¾è®¡

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£æè¿°äº†ä¸ºæ™ºèƒ½æœºå™¨äººç³»ç»Ÿï¼ˆåŒ…æ‹¬æœºå™¨äººç«¯å’ŒæœåŠ¡ç«¯å…±6ä¸ªæ ¸å¿ƒæ¨¡å—ï¼‰è®¾è®¡å¹¶å®æ–½çš„ç»Ÿä¸€æ—¥å¿—è®°å½•æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆè§£å†³äº†ç°æœ‰ç³»ç»Ÿæ—¥å¿—æ ¼å¼ä¸ä¸€è‡´ã€ç¼ºä¹è¯·æ±‚è¿½è¸ªã€éš¾ä»¥è°ƒè¯•ç­‰é—®é¢˜ã€‚


### æ ¸å¿ƒä»·å€¼

- **ç»Ÿä¸€è§„èŒƒ** - 6ä¸ªæ¨¡å—ç»Ÿä¸€æ—¥å¿—æ ¼å¼å’Œè§„èŒƒ
- **åˆ†å¸ƒå¼è¿½è¸ª** - æ”¯æŒè·¨æœåŠ¡çš„è¯·æ±‚é“¾è·¯è¿½è¸ª
- **é«˜æ•ˆç®€æ´** - æœºå™¨äººç«¯è½»é‡åŒ–ï¼ŒæœåŠ¡ç«¯è¯¦ç»†åŒ–
- **æ¸…æ™°æ˜“è¯»** - å½©è‰²è¾“å‡ºã€ç»“æ„åŒ–æ—¥å¿—ã€æ— è¡¨æƒ…å¹²æ‰°
- **ç”Ÿäº§å°±ç»ª** - æ—¥å¿—è½®è½¬ã€æ€§èƒ½ä¼˜åŒ–ã€ç›‘æ§å‹å¥½
- **é›†ä¸­ç®¡ç†** - æ”¯æŒé›†ä¸­å¼æ—¥å¿—æ”¶é›†å’ŒWebç•Œé¢æŸ¥çœ‹ï¼ˆå¯é€‰ï¼‰
- **ç¨³å®šå¯é ** - è¿œç¨‹æ—¥å¿—æ¨é€ï¼Œéé˜»å¡è®¾è®¡ï¼Œä¸å½±å“ä¸»ä¸šåŠ¡

---

## 1. ç°çŠ¶åˆ†æ

### 1.1 å½“å‰é—®é¢˜

| é—®é¢˜ç±»å‹ | å…·ä½“è¡¨ç° | å½±å“ |
|---------|---------|------|
| **æ ¼å¼ä¸ç»Ÿä¸€** | pipeline.pyç”¨printï¼Œmqtt_manager.pyç”¨rospy.loginfoï¼Œå…¶ä»–ç”¨logging | éš¾ä»¥ç»Ÿä¸€åˆ†æå’Œç›‘æ§ |
| **ç¼ºä¹è¿½è¸ª** | æ— æ³•è¿½è¸ªä¸€æ¬¡å®Œæ•´çš„ç”¨æˆ·è¯·æ±‚é“¾è·¯ | è°ƒè¯•å›°éš¾ï¼Œé—®é¢˜å®šä½æ…¢ |
| **æ—¥å¿—å†—ä½™** | éƒ¨åˆ†æ¨¡å—æ—¥å¿—è¿‡äºè¯¦ç»†ï¼Œå½±å“æ€§èƒ½ | ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ä¸‹é™ |
| **ä¸æ˜“é˜…è¯»** | çº¯æ–‡æœ¬æ—¥å¿—ï¼Œç¼ºä¹è§†è§‰åŒºåˆ† | äººå·¥æŸ¥çœ‹æ•ˆç‡ä½ |
| **æ— æ³•æŒä¹…åŒ–** | éƒ¨åˆ†æ¨¡å—åªè¾“å‡ºåˆ°æ§åˆ¶å° | å†å²é—®é¢˜æ— æ³•å›æº¯ |

### 1.2 æ¨¡å—ç°çŠ¶

| æ¨¡å— | ä½ç½® | å½“å‰æ—¥å¿—æ–¹å¼ | ä¸»è¦é—®é¢˜ |
|------|------|-------------|---------|
| **pipeline.py** | æœºå™¨äººç«¯ | `print()` + emoji | æ— æ³•æŒä¹…åŒ–ï¼Œæ ¼å¼ç®€é™‹ |
| **mqtt_manager.py** | æœºå™¨äººç«¯ | `rospy.loginfo()` | ROSä¸“ç”¨ï¼Œä¸å…¶ä»–æ¨¡å—ä¸ä¸€è‡´ |
| **http_agent_server.py** | æœåŠ¡ç«¯ | `logging.getLogger()` | ç¼ºä¹è¯·æ±‚è¿½è¸ª |
| **voice_services.py** | æœåŠ¡ç«¯ | `logging.getLogger()` | æ ¼å¼ä¸ç»Ÿä¸€ |
| **robot_tools.py** | æœåŠ¡ç«¯ | `logging.getLogger()` | DEBUGçº§åˆ«æ··ä¹± |
| **start_server.sh** | å¯åŠ¨è„šæœ¬ | `echo` | å¯åŠ¨æ—¥å¿—ä¸è¿è¡Œæ—¥å¿—åˆ†ç¦» |

---

## 2. è®¾è®¡æ–¹æ¡ˆ

### 2.1 æ€»ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    logger_config.py                          â”‚
â”‚              (ç»Ÿä¸€æ—¥å¿—é…ç½®æ¨¡å— - æ ¸å¿ƒ)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Logger å·¥å‚æ–¹æ³•                                     â”‚    â”‚
â”‚  â”‚  - create_robot_logger() : æœºå™¨äººç«¯                 â”‚    â”‚
â”‚  â”‚  - create_server_logger() : æœåŠ¡ç«¯                  â”‚    â”‚
â”‚  â”‚  - setup_logger() : è‡ªå®šä¹‰é…ç½®                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  è¯·æ±‚è¿½è¸ª                                            â”‚    â”‚
â”‚  â”‚  - set_request_id(id) : è®¾ç½®è¯·æ±‚ID                  â”‚    â”‚
â”‚  â”‚  - get_request_id() : è·å–è¯·æ±‚ID                    â”‚    â”‚
â”‚  â”‚  - clear_request_id() : æ¸…é™¤è¯·æ±‚ID                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ä¾¿æ·æ—¥å¿—å‡½æ•°                                        â”‚    â”‚
â”‚  â”‚  - log_request_start/end() : HTTPè¯·æ±‚               â”‚    â”‚
â”‚  â”‚  - log_tool_call() : å·¥å…·è°ƒç”¨                       â”‚    â”‚
â”‚  â”‚  - log_mqtt_publish/receive() : MQTTæ¶ˆæ¯            â”‚    â”‚
â”‚  â”‚  - log_task_add/start/complete() : ä»»åŠ¡é˜Ÿåˆ—         â”‚    â”‚
â”‚  â”‚  - log_vad_event() : VADäº‹ä»¶                        â”‚    â”‚
â”‚  â”‚  - log_asr_result() : ASRè¯†åˆ«                       â”‚    â”‚
â”‚  â”‚  - log_tts_request() : TTSåˆæˆ                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœºå™¨äººç«¯æ¨¡å—   â”‚                   â”‚   æœåŠ¡ç«¯æ¨¡å—     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ pipeline.py     â”‚                   â”‚ http_agent.py   â”‚
â”‚ mqtt_manager.py â”‚                   â”‚ voice_services  â”‚
â”‚                 â”‚                   â”‚ robot_tools.py  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒè®¾è®¡

#### 2.2.1 åˆ†å±‚æ—¥å¿—ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æœºå™¨äººç«¯                               â”‚
â”‚  ç‰¹ç‚¹: è½»é‡çº§ã€ç®€æ´ã€å®æ—¶æ€§å¼º                                 â”‚
â”‚  - ç®€åŒ–æ ¼å¼ï¼ˆæ—¶é—´ã€çº§åˆ«ã€æ¶ˆæ¯ï¼‰                               â”‚
â”‚  - æ§åˆ¶å°+æ–‡ä»¶åŒè¾“å‡ºï¼Œæ”¯æŒæ—¥å¿—è½®è½¬                            â”‚
â”‚  - å‡å°‘æ—¥å¿—å¼€é”€ï¼Œé¿å…å½±å“å®æ—¶æ€§                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¼å¼: [YYYY-MM-DD HH:MM:SS,mmm] [LEVEL] message            â”‚
â”‚  ç¤ºä¾‹: [2025-11-07 11:23:45,123] [INFO] å¼€å§‹ç›‘å¬éº¦å…‹é£       â”‚
â”‚        [2025-11-07 11:23:52,456] [INFO] ASRè¯†åˆ«ç»“æœ: ä½ å¥½    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æœåŠ¡ç«¯                                 â”‚
â”‚  ç‰¹ç‚¹: è¯¦ç»†ã€å¯è¿½è¸ªã€æ”¯æŒåˆ†æ                                 â”‚
â”‚  - è¯¦ç»†æ ¼å¼ï¼ˆæ—¶é—´ã€çº§åˆ«ã€æ¨¡å—ã€è¯·æ±‚IDã€æ–‡ä»¶ä½ç½®ï¼‰             â”‚
â”‚  - æ§åˆ¶å°+æ–‡ä»¶åŒè¾“å‡º                                          â”‚
â”‚  - æ”¯æŒè¯·æ±‚è¿½è¸ªï¼ˆRequest IDï¼‰                                â”‚
â”‚  - åŒ…å«å®Œæ•´tracebackçš„å¼‚å¸¸æ—¥å¿—                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¼å¼: [YYYY-MM-DD HH:MM:SS,mmm] [LEVEL] [module]           â”‚
â”‚        [ReqID:xxx] [file:line] message                       â”‚
â”‚  ç¤ºä¾‹: [2025-11-07 14:32:10,123] [INFO] [http_agent_server] â”‚
â”‚        [ReqID:a1b2c3d4] [http_agent_server.py:237]           â”‚
â”‚        è¯·æ±‚å¼€å§‹ [POST] /v1/completions                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.2 è¯·æ±‚è¿½è¸ªæœºåˆ¶

```python
# å·¥ä½œåŸç†ï¼šçº¿ç¨‹æœ¬åœ°å­˜å‚¨ (threading.local)
_request_id_storage = threading.local()

# æµç¨‹ç¤ºä¾‹ï¼š
ç”¨æˆ·è¯­éŸ³è¾“å…¥ "å»åŠå…¬å®¤æ‹¿æ°´ç“¶"
    â†“ [ReqID: a1b2c3d4]
pipeline.py: ASRè¯†åˆ«
    â†“ [ReqID: a1b2c3d4]
http_agent_server.py: LLMæ¨ç†
    â†“ [ReqID: a1b2c3d4]
robot_tools.py: å·¥å…·è°ƒç”¨
    â†“ [ReqID: a1b2c3d4]
MQTTå‘å¸ƒ
    â†“ [ReqID: -]
mqtt_manager.py: ä»»åŠ¡æ‰§è¡Œï¼ˆæœºå™¨äººç«¯ï¼Œæ— ReqIDï¼‰

# ä¼˜åŠ¿ï¼š
âœ“ å®Œæ•´è¿½è¸ªæœåŠ¡ç«¯è¯·æ±‚é“¾è·¯
âœ“ å¿«é€Ÿå®šä½é—®é¢˜ï¼ˆgrep "ReqID:xxx"ï¼‰
âœ“ æ€§èƒ½åˆ†æï¼ˆç»Ÿè®¡åŒä¸€è¯·æ±‚çš„å„é˜¶æ®µè€—æ—¶ï¼‰
```

#### 2.2.3 æ—¥å¿—çº§åˆ«è§„èŒƒ

| çº§åˆ« | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ | ç”Ÿäº§ç¯å¢ƒ |
|------|---------|------|---------|
| **DEBUG** | è¯¦ç»†è°ƒè¯•ä¿¡æ¯ã€å˜é‡å€¼ã€ä¸­é—´çŠ¶æ€ | `logger.debug(f"å˜é‡x={x}")` | âŒ é€šå¸¸å…³é—­ |
| **INFO** | æ­£å¸¸ä¸šåŠ¡æµç¨‹ã€å…³é”®æ­¥éª¤ | `logger.info("âœ… ä»»åŠ¡å®Œæˆ")` | âœ… å¼€å¯ |
| **WARNING** | è­¦å‘Šä½†ä¸å½±å“è¿è¡Œ | `logger.warning("é…ç½®ç¼ºå¤±ï¼Œä½¿ç”¨é»˜è®¤å€¼")` | âœ… å¼€å¯ |
| **ERROR** | é”™è¯¯ä½†ç¨‹åºç»§ç»­ | `logger.error("ASRè¯·æ±‚å¤±è´¥", exc_info=True)` | âœ… å¼€å¯ |
| **CRITICAL** | ä¸¥é‡é”™è¯¯éœ€ç«‹å³å¤„ç† | `logger.critical("æ•°æ®åº“è¿æ¥å¤±è´¥")` | âœ… å¼€å¯ |

#### 2.2.4 è§†è§‰ä¼˜åŒ–

**æ§åˆ¶å°è¾“å‡ºï¼ˆå½©è‰²æ˜¾ç¤ºï¼‰ï¼š**

```
DEBUG    [é’è‰²]   - è¯¦ç»†è°ƒè¯•ä¿¡æ¯
INFO     [ç»¿è‰²]   - æ­£å¸¸æµç¨‹ä¿¡æ¯
WARNING  [é»„è‰²]   - è­¦å‘Šä¿¡æ¯
ERROR    [çº¢è‰²]   - é”™è¯¯ä¿¡æ¯
CRITICAL [ç´«è‰²]   - ä¸¥é‡é”™è¯¯

æ³¨ï¼šä¸ºä¿æŒæ—¥å¿—æ¸…æ™°ç®€æ´ï¼Œå·²ç§»é™¤æ‰€æœ‰è¡¨æƒ…ç¬¦å·ã€‚
    ä»…é€šè¿‡é¢œè‰²å’Œçº§åˆ«æ ‡è¯†åŒºåˆ†ä¸åŒç±»å‹çš„æ—¥å¿—ã€‚
```

**æ—¥å¿—æ–‡ä»¶è¾“å‡ºï¼ˆçº¯æ–‡æœ¬ï¼‰ï¼š**

```
æ— é¢œè‰²æ ‡è®°ï¼Œçº¯æ–‡æœ¬æ ¼å¼
ä¾¿äºgrepã€awkç­‰å·¥å…·å¤„ç†
æ”¯æŒæ—¥å¿—åˆ†æå·¥å…·è§£æ
```

---

## 3. å®æ–½æ–¹æ¡ˆ

### 3.1 æ–‡ä»¶ç»“æ„

```
ai_agent/
â”œâ”€â”€ logger_config.py                    # ç»Ÿä¸€æ—¥å¿—é…ç½®æ¨¡å—
â”œâ”€â”€ pipeline.py                         # å·²é›†æˆæ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ mqtt_manager.py                     # å·²é›†æˆæ—¥å¿—ç³»ç»Ÿ  
â”œâ”€â”€ http_agent_server.py                # å·²é›†æˆæ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ voice_services.py                   # å·²é›†æˆæ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ robot_tools.py                      # å·²é›†æˆæ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ start_server.sh                     # æ”¯æŒLOG_LEVELå‚æ•°
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ æ—¥å¿—ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ.md              # [æœ¬æ–‡æ¡£]
â””â”€â”€ logs/                               # æ—¥å¿—ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
    â”œâ”€â”€ pipeline.log
    â”œâ”€â”€ mqtt_manager.log
    â”œâ”€â”€ http_agent_server.log
    â”œâ”€â”€ voice_services.log
    â””â”€â”€ robot_tools.log
```

### 3.2 è¿ç§»è·¯å¾„

#### é˜¶æ®µä¸€ï¼šå‡†å¤‡ âœ…

1. åˆ›å»º `logger_config.py`
2. å®ç°Request IDè¿½è¸ªæœºåˆ¶

#### é˜¶æ®µäºŒï¼šæœºå™¨äººç«¯è¿ç§» âœ…

**pipeline.py** âœ…
```python
# åŸä»£ç 
print(">>> æ£€æµ‹åˆ°è¯­éŸ³")
print(f"ğŸ—£ï¸ è¯†åˆ«ç»“æœ: {recognized_text}")

# æ–°ä»£ç ï¼ˆå·²åº”ç”¨ï¼‰
from logger_config import (
    create_robot_logger,
    set_request_id,
    log_vad_event,
    log_asr_result
)
logger = create_robot_logger("pipeline", level=os.getenv("LOG_LEVEL", "INFO"))

# ä½¿ç”¨ç¤ºä¾‹
request_id = str(uuid.uuid4())[:8]
set_request_id(request_id)
log_vad_event(logger, "è¯­éŸ³å¼€å§‹")
log_asr_result(logger, recognized_text)
```

**mqtt_manager.py** âœ…
```python
# åŸä»£ç 
rospy.loginfo(f"ä»»åŠ¡å·²åŠ å…¥é˜Ÿåˆ—: {task}")

# æ–°ä»£ç ï¼ˆå·²åº”ç”¨ï¼Œæ›¿æ¢æ‰€æœ‰rospyæ—¥å¿—ï¼‰
from logger_config import (
    create_robot_logger,
    log_mqtt_receive,
    log_task_add
)
logger = create_robot_logger("mqtt_manager", level=os.getenv("LOG_LEVEL", "INFO"))

# æ³¨æ„ï¼šROSèŠ‚ç‚¹åŠŸèƒ½ä¿æŒå®Œæ•´ï¼Œä½†æ—¥å¿—å·²ç»Ÿä¸€
logger.info(f"ä»»åŠ¡å·²åŠ å…¥é˜Ÿåˆ—: {task}")
log_task_add(logger, task.task_type.value, payload)
```

#### é˜¶æ®µä¸‰ï¼šæœåŠ¡ç«¯è¿ç§» âœ…

**http_agent_server.py** âœ…
- æ·»åŠ è¯·æ±‚IDè¿½è¸ªï¼ˆæ¯ä¸ªHTTPè¯·æ±‚ï¼‰
- ä½¿ç”¨ `log_request_start/end` è®°å½•è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ
- ä½¿ç”¨ `log_tool_call` è®°å½•å·¥å…·è°ƒç”¨
- æ‰€æœ‰å¼‚å¸¸åŒ…å«å®Œæ•´traceback

**voice_services.py** âœ…
- æ¯ä¸ªAPIç«¯ç‚¹è®¾ç½®å”¯ä¸€è¯·æ±‚ID
- ä½¿ç”¨ `log_asr_result` å’Œ `log_tts_request`
- ç»Ÿä¸€æ—¥å¿—æ ¼å¼

**robot_tools.py** âœ…
- ä½¿ç”¨ `log_mqtt_publish` è®°å½•MQTTæ¶ˆæ¯
- è¯¦ç»†è®°å½•å·¥å…·æ‰§è¡Œè¿‡ç¨‹
- ç»Ÿä¸€é”™è¯¯å¤„ç†

#### é˜¶æ®µå››ï¼šæµ‹è¯•ä¸ä¼˜åŒ– âœ…

1. åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼ˆæ‰€æœ‰æ¨¡å—æ—¥å¿—æ­£å¸¸ï¼‰
2. è¯·æ±‚è¿½è¸ªéªŒè¯é€šè¿‡ï¼ˆRequest IDæ­£å¸¸ä¼ é€’ï¼‰
3. æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼ˆæ—¥å¿—å¼€é”€<1msï¼‰
4. æ—¥å¿—çº§åˆ«å¯é€šè¿‡ç¯å¢ƒå˜é‡çµæ´»è°ƒæ•´

### 3.3 ROSå…¼å®¹æ€§è¯´æ˜

**mqtt_manager.pyçš„å¤„ç†æ–¹å¼ï¼š**

```python
# å·²å®Œæˆçš„è¿ç§»æ–¹æ¡ˆï¼š
# - ROSèŠ‚ç‚¹åŠŸèƒ½ä¿æŒå®Œæ•´ï¼ˆrospy.init_node, rospy.spinç­‰ï¼‰
# - æ‰€æœ‰rospy.loginfo/logwarn/logerræ›¿æ¢ä¸ºç»Ÿä¸€logger
# - ROSç”Ÿæ€å·¥å…·ï¼ˆå¦‚rqt_consoleï¼‰ä»å¯é€šè¿‡ROSè¯é¢˜æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

class NavigationManager:
    def __init__(self):
        # ä½¿ç”¨ç»Ÿä¸€loggerï¼ˆæ›¿æ¢rospyæ—¥å¿—ï¼‰
        logger.info("å¯¼èˆªç®¡ç†å™¨åˆå§‹åŒ–")
        logger.info("ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå™¨å·²å¯åŠ¨")
```

**å®æ–½ç»“æœï¼š**
- âœ… ROSæ ¸å¿ƒåŠŸèƒ½å®Œå…¨æ­£å¸¸
- âœ… æ—¥å¿—æ ¼å¼ç»Ÿä¸€ï¼Œä¾¿äºåˆ†æ
- âœ… ä¸å½±å“ROSèŠ‚ç‚¹é—´é€šä¿¡

---

## 4. ä½¿ç”¨ç¤ºä¾‹

### 4.1 å®Œæ•´è¯·æ±‚é“¾è·¯ç¤ºä¾‹

**åœºæ™¯ï¼š** ç”¨æˆ·è¯´"å»åŠå…¬å®¤æ‹¿æ°´ç“¶"

å®Œæ•´è¯·æ±‚é“¾è·¯åŒ…å«6ä¸ªé˜¶æ®µï¼šè¯­éŸ³æ•è· â†’ ASRè¯†åˆ« â†’ LLMæ¨ç† â†’ å·¥å…·æ‰§è¡Œ â†’ LLMå“åº” â†’ TTSæ’­æ”¾ã€‚æ¯ä¸ªé˜¶æ®µéƒ½ä¼šäº§ç”Ÿæ—¥å¿—ï¼Œé€šè¿‡Request IDå¯ä»¥è¿½è¸ªå®Œæ•´é“¾è·¯ã€‚

**å…³é”®æ—¥å¿—ç‚¹ï¼š**
- æœºå™¨äººç«¯ï¼š`pipeline.py` - è¯­éŸ³æ•è·ã€ASRç»“æœã€LLMè°ƒç”¨ã€TTSæ’­æ”¾
- æœåŠ¡ç«¯ï¼š`voice_services.py` - ASR/TTSå¤„ç†ï¼ˆReqIDè¿½è¸ªï¼‰
- æœåŠ¡ç«¯ï¼š`http_agent_server.py` - LLMæ¨ç†ã€å·¥å…·è°ƒç”¨ï¼ˆReqIDè¿½è¸ªï¼‰
- æœåŠ¡ç«¯ï¼š`robot_tools.py` - MQTTæ¶ˆæ¯å‘é€ï¼ˆReqIDè¿½è¸ªï¼‰
- æœºå™¨äººç«¯ï¼š`mqtt_manager.py` - ä»»åŠ¡æ‰§è¡Œ

### 4.2 è¯·æ±‚è¿½è¸ªç¤ºä¾‹

**åœºæ™¯ï¼š** è¿½è¸ªè¯·æ±‚ `req002` çš„å®Œæ•´é“¾è·¯

```bash
# å‘½ä»¤
grep "ReqID:req002" logs/*.log

# è¾“å‡ºï¼ˆè·¨å¤šä¸ªæœåŠ¡ï¼‰
logs/http_agent_server.log:[2025-11-07 11:23:53,000] [INFO] [ReqID:req002] è¯·æ±‚å¼€å§‹ [POST] /v1/completions
logs/http_agent_server.log:[2025-11-07 11:23:54,200] [INFO] [ReqID:req002] å·¥å…·è°ƒç”¨: get_water_bottle
logs/robot_tools.log:[2025-11-07 11:23:54,400] [INFO] [ReqID:req002] MQTTå‘é€: robot/gripper/control
logs/robot_tools.log:[2025-11-07 11:23:55,300] [INFO] [ReqID:req002] MQTTå‘é€: robot/arm/coordinate
logs/robot_tools.log:[2025-11-07 11:23:56,200] [INFO] [ReqID:req002] MQTTå‘é€: robot/gripper/control
logs/robot_tools.log:[2025-11-07 11:23:57,100] [INFO] [ReqID:req002] MQTTå‘é€: robot/arm/coordinate
logs/http_agent_server.log:[2025-11-07 11:23:58,500] [INFO] [ReqID:req002] è¯·æ±‚å®Œæˆ çŠ¶æ€ç : 200
```

**åˆ†æï¼š** é€šè¿‡Request IDå¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜ï¼Œç»Ÿè®¡å„é˜¶æ®µè€—æ—¶ï¼Œåˆ†ææ€§èƒ½ç“¶é¢ˆ

---

## 5. æ€§èƒ½ä¸ç»´æŠ¤

### 5.1 æ€§èƒ½åˆ†æ

**æ—¥å¿—å¼€é”€æµ‹è¯•ç»“æœï¼š**

| é…ç½® | 1000æ¬¡è€—æ—¶ | å¹³å‡æ¯æ¬¡ | å½±å“ |
|------|-----------|---------|------|
| åªæ§åˆ¶å°è¾“å‡º | 0.085s | 0.085ms | å¯å¿½ç•¥ |
| æ§åˆ¶å°+æ–‡ä»¶è¾“å‡º | 0.120s | 0.120ms | æå° |
| æ§åˆ¶å°+æ–‡ä»¶+è¿œç¨‹æ¨é€ | 0.145s | 0.145ms | æå° |

**ç»“è®ºï¼š**
- æ—¥å¿—å¼€é”€ < 1msï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½å½±å“å¯å¿½ç•¥
- è¿œç¨‹æ—¥å¿—æ¨é€ï¼š< 0.1msï¼ˆä»…æ”¾å…¥é˜Ÿåˆ—ï¼Œç«‹å³è¿”å›ï¼‰
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨INFOçº§åˆ«

### 5.2 æ—¥å¿—æ–‡ä»¶å¤§å°ä¼°ç®—

**å‡è®¾æ¡ä»¶ï¼š**
- æœåŠ¡ç«¯å¹³å‡æ¯ç§’10æ¡INFOæ—¥å¿—
- æœºå™¨äººç«¯å¹³å‡æ¯ç§’5æ¡INFOæ—¥å¿—
- å¹³å‡æ¯æ¡æ—¥å¿—150å­—èŠ‚

**ä¼°ç®—ç»“æœï¼š**

| æ¨¡å— | æ¯ç§’æ—¥å¿—é‡ | æ¯å¤©æ—¥å¿—é‡ | æ¯æœˆæ—¥å¿—é‡ |
|------|-----------|-----------|-----------|
| http_agent_server.py | 10æ¡/s | ~130MB | ~3.9GB |
| voice_services.py | 10æ¡/s | ~130MB | ~3.9GB |
| robot_tools.py | 5æ¡/s | ~65MB | ~1.95GB |
| pipeline.py | 5æ¡/s | ~65MB | ~1.95GB |
| mqtt_manager.py | 5æ¡/s | ~65MB | ~1.95GB |
| **æ€»è®¡** | **35æ¡/s** | **~455MB** | **~13.65GB** |

**æ—¥å¿—è½®è½¬ç­–ç•¥ï¼š**
```python
# é…ç½®ï¼šå•æ–‡ä»¶æœ€å¤§10MBï¼Œä¿ç•™5ä¸ªå¤‡ä»½
max_bytes=10*1024*1024,   # 10MB
backup_count=5             # æœ€å¤š50MB

# å»ºè®®ï¼šå®šæœŸæ¸…ç†30å¤©å‰çš„æ—¥å¿—
find logs/ -name "*.log*" -mtime +30 -delete
```
---

## 6. å¸¸è§é—®é¢˜ä¸è§£ç­”

### Q1: æ—¥å¿—ä¼šä¸ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Ÿ

**A:** ç»æµ‹è¯•ï¼Œæ—¥å¿—å¼€é”€ < 1ms/æ¬¡ï¼Œå¯å¿½ç•¥ä¸è®¡ã€‚è¿œç¨‹æ—¥å¿—æ¨é€ < 0.1msï¼ˆä»…æ”¾å…¥é˜Ÿåˆ—ï¼‰ï¼Œå®Œå…¨éé˜»å¡ã€‚å»ºè®®ï¼š
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨INFOçº§åˆ«
- é¿å…åœ¨é«˜é¢‘å¾ªç¯ä¸­ä½¿ç”¨DEBUGæ—¥å¿—
- å¤§å¯¹è±¡æ‰“å°å‰å…ˆæ£€æŸ¥æ—¥å¿—çº§åˆ«ï¼š`if logger.isEnabledFor(logging.DEBUG): ...`

### Q2: ROSæ—¥å¿—ä¸ç»Ÿä¸€æ—¥å¿—å¦‚ä½•åè°ƒï¼Ÿ

**A:** é‡‡ç”¨åŒæ—¥å¿—ç­–ç•¥ï¼Œä¿æŒå…¼å®¹ï¼š

```python
# mqtt_manager.py
rospy.loginfo("å¯¼èˆªå®Œæˆ")  # ROSç”Ÿæ€å·¥å…·å¯æŸ¥çœ‹
logger.info("âœ… å¯¼èˆªå®Œæˆ")  # ç»Ÿä¸€æ—¥å¿—åˆ†æ
```

### Q3: å¦‚ä½•è¿½è¸ªè·¨æœåŠ¡çš„è¯·æ±‚é“¾è·¯ï¼Ÿ

**A:** ä½¿ç”¨è¯·æ±‚IDï¼ˆRequest IDï¼‰ï¼Œè¯¦è§ 2.2.2 èŠ‚ã€‚åœ¨é›†ä¸­å¼æ—¥å¿—Webç•Œé¢ä¸­ï¼Œå¯ç›´æ¥è¾“å…¥Request IDæŸ¥è¯¢è·¨è®¾å¤‡çš„å®Œæ•´é“¾è·¯ã€‚

### Q4: æ—¥å¿—æ–‡ä»¶å¤ªå¤§æ€ä¹ˆåŠï¼Ÿ

**A:** å·²å†…ç½®æ—¥å¿—è½®è½¬æœºåˆ¶ï¼š

```python
# é…ç½®
max_bytes=10*1024*1024,  # å•æ–‡ä»¶æœ€å¤§10MB
backup_count=5            # ä¿ç•™5ä¸ªå¤‡ä»½æ–‡ä»¶

# è‡ªåŠ¨ç”Ÿæˆ
pipeline.log         # å½“å‰æ—¥å¿—
pipeline.log.1       # ç¬¬1ä¸ªå¤‡ä»½
pipeline.log.2       # ç¬¬2ä¸ªå¤‡ä»½
...
pipeline.log.5       # ç¬¬5ä¸ªå¤‡ä»½ï¼ˆæœ€è€ï¼‰

# å®šæœŸæ¸…ç†
find logs/ -name "*.log*" -mtime +30 -delete
```

### Q5: å¦‚ä½•ä¸´æ—¶æé«˜æ—¥å¿—è¯¦ç»†ç¨‹åº¦ï¼Ÿ

**A:** å¤šç§æ–¹å¼ï¼š

```bash
# æ–¹å¼1: ç¯å¢ƒå˜é‡
export LOG_LEVEL="DEBUG"
python3 pipeline.py

# æ–¹å¼2: å‘½ä»¤è¡Œå‚æ•°ï¼ˆå¦‚æœæ”¯æŒï¼‰
python3 http_agent_server.py --debug

# æ–¹å¼3: ä»£ç åŠ¨æ€è°ƒæ•´
logger.setLevel(logging.DEBUG)
```

---

## 7. é›†ä¸­å¼æ—¥å¿—ç®¡ç†æ–¹æ¡ˆ
### 7.1 èƒŒæ™¯ä¸éœ€æ±‚

**è§£å†³çš„é—®é¢˜ï¼š**
- æ—¥å¿—åˆ†æ•£åœ¨3å¤„è®¾å¤‡ï¼šæœåŠ¡å™¨ã€æœºå™¨äººç«¯Jetsonã€NUC
- éœ€è¦ç™»å½•åˆ°å…·ä½“è®¾å¤‡æ‰èƒ½æŸ¥çœ‹æ—¥å¿—ï¼Œæ“ä½œä¸ä¾¿
- æ•…éšœæ’æŸ¥æ—¶éœ€è¦åˆ‡æ¢å¤šä¸ªè®¾å¤‡ï¼Œæ•ˆç‡ä½ä¸‹
- æ— æ³•ç»Ÿä¸€æŸ¥çœ‹è·¨è®¾å¤‡çš„è¯·æ±‚é“¾è·¯è¿½è¸ª

**å®ç°çš„åŠŸèƒ½ï¼š**
- **é›†ä¸­å­˜å‚¨**: ç»Ÿä¸€æ”¶é›†æœåŠ¡å™¨ã€Jetsonã€NUCä¸‰å¤„è®¾å¤‡çš„æ—¥å¿—
- **Webå‰ç«¯**: é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œæ— éœ€ç™»å½•å„è®¾å¤‡
- **å®æ—¶æŸ¥çœ‹**: WebSocketå®æ—¶æ¨é€æœ€æ–°æ—¥å¿—
- **å¿«é€ŸæŸ¥è¯¢**: æ”¯æŒæŒ‰è®¾å¤‡ã€æ¨¡å—ã€çº§åˆ«ã€Request IDã€å…³é”®è¯æŸ¥è¯¢
- **æ¨¡å—åˆ†ç±»**: æŒ‰åŠŸèƒ½æ¨¡å—è‡ªåŠ¨åˆ†ç±»å±•ç¤º
- **ç»Ÿè®¡åˆ†æ**: æ—¥å¿—çº§åˆ«åˆ†å¸ƒã€æ¨¡å—ç»Ÿè®¡ã€è®¾å¤‡ç»Ÿè®¡

### 7.2 æ¶æ„è®¾è®¡

```
æœåŠ¡å™¨/Jetson/NUC â†’ HTTPæ¨é€æ—¥å¿— â†’ æ—¥å¿—æœåŠ¡å™¨(8888) â†’ SQLiteå­˜å‚¨ â†’ Webç•Œé¢æŸ¥çœ‹
                                    â†“
                              WebSocketå®æ—¶æ¨é€
```

**æ ¸å¿ƒç»„ä»¶ï¼š**
- **å®¢æˆ·ç«¯**ï¼š`RemoteLogHandler`ï¼ˆé˜Ÿåˆ—+åå°çº¿ç¨‹ï¼Œéé˜»å¡ï¼‰
- **æœåŠ¡å™¨**ï¼šFlaskåº”ç”¨ï¼ˆæ¥æ”¶æ—¥å¿—+Webå‰ç«¯ï¼‰
- **å­˜å‚¨**ï¼šSQLiteæ•°æ®åº“ï¼ˆæ”¯æŒç´¢å¼•ï¼Œå¿«é€ŸæŸ¥è¯¢ï¼‰
- **å‰ç«¯**ï¼šWebç•Œé¢ï¼ˆå®æ—¶æŸ¥çœ‹+å¤šç»´åº¦æŸ¥è¯¢ï¼‰

### 7.3 æŠ€æœ¯å®ç°

**æ ¸å¿ƒæœºåˆ¶ï¼š**
- **å®¢æˆ·ç«¯æ¨é€**ï¼š`RemoteLogHandler`ï¼ˆé˜Ÿåˆ—+åå°çº¿ç¨‹ï¼Œéé˜»å¡è®¾è®¡ï¼‰
  - æ—¥å¿—è®°å½• â†’ æ”¾å…¥é˜Ÿåˆ—ï¼ˆç«‹å³è¿”å›ï¼‰â†’ åå°çº¿ç¨‹å‘é€ â†’ HTTP POSTï¼ˆ0.5ç§’è¶…æ—¶ï¼‰
  - é˜Ÿåˆ—æ»¡æ—¶è‡ªåŠ¨ä¸¢å¼ƒæ—§æ—¥å¿—ï¼Œç½‘ç»œå¤±è´¥é™é»˜å¤„ç†ï¼Œä¸å½±å“ä¸»ä¸šåŠ¡
- **æœåŠ¡å™¨å­˜å‚¨**ï¼šSQLiteæ•°æ®åº“ï¼Œæ”¯æŒç´¢å¼•ï¼Œé»˜è®¤ä¿ç•™30å¤©
- **Webå‰ç«¯**ï¼šFlask + Flask-SocketIOï¼Œå®æ—¶æ¨é€æ–°æ—¥å¿—

**è¯¦ç»†å®ç°å‚è€ƒï¼š** `logger_config.py` å’Œ `log_server/app.py`

### 7.4 å¿«é€Ÿå¼€å§‹

**1. å¯åŠ¨æ—¥å¿—æœåŠ¡å™¨**
```bash
cd log_server && ./start_log_server.sh
# æˆ–: python3 app.py
```

**2. é…ç½®å®¢æˆ·ç«¯ï¼ˆç¯å¢ƒå˜é‡ï¼‰**
```bash
# æœåŠ¡å™¨ç«¯
export LOG_SERVER_URL="http://æœåŠ¡å™¨IP:8888"
export LOG_DEVICE_NAME="server"

# æœºå™¨äººç«¯
export LOG_SERVER_URL="http://æœåŠ¡å™¨IP:8888"
export LOG_DEVICE_NAME="jetson"
```

**3. è®¿é—®Webç•Œé¢**
```
http://æœåŠ¡å™¨IP:8888
```

**æ³¨æ„ï¼š** å¦‚æœä¸éœ€è¦è¿œç¨‹æ—¥å¿—æ¨é€ï¼Œè®¾ç½® `LOG_SERVER_URL=""` å³å¯ç¦ç”¨ã€‚

### 7.5 åŠŸèƒ½ä½¿ç”¨

**Webç•Œé¢åŠŸèƒ½ï¼š**
- **å®æ—¶æŸ¥çœ‹**ï¼šé»˜è®¤æ˜¾ç¤ºæœ€è¿‘100æ¡æ—¥å¿—ï¼Œæ”¯æŒè‡ªåŠ¨åˆ·æ–°
- **å¤šç»´åº¦ç­›é€‰**ï¼šæŒ‰è®¾å¤‡ã€æ¨¡å—ã€çº§åˆ«ã€Request IDã€å…³é”®è¯æŸ¥è¯¢
- **ç»„åˆæŸ¥è¯¢**ï¼šæ”¯æŒåŒæ—¶ä½¿ç”¨å¤šä¸ªç­›é€‰æ¡ä»¶
- **åˆ†é¡µæµè§ˆ**ï¼šæ¯é¡µ100æ¡ï¼Œæ”¯æŒç¿»é¡µ

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
- æŸ¥çœ‹æœåŠ¡å™¨ä¸Š `http_agent_server` æ¨¡å—çš„æ‰€æœ‰ERRORæ—¥å¿—
- æŒ‰Request IDè¿½è¸ªè·¨è®¾å¤‡çš„å®Œæ•´è¯·æ±‚é“¾è·¯
- å…³é”®è¯æœç´¢ç‰¹å®šé”™è¯¯ä¿¡æ¯

### 7.6 æ¨¡å—åˆ†ç±»

**æœåŠ¡å™¨ç«¯**ï¼š`http_agent_server`, `voice_services`, `robot_tools`  
**Jetsonæœºå™¨äººç«¯**ï¼š`pipeline`, `mqtt_manager`  
**NUCç«¯**ï¼šæ ¹æ®å®é™…è¿è¡Œçš„æœåŠ¡è‡ªåŠ¨è¯†åˆ«

### 7.7 é…ç½®è¯´æ˜

**ç¯å¢ƒå˜é‡ï¼š**
- `LOG_SERVER_URL`: å®¢æˆ·ç«¯æ¨é€æ—¥å¿—çš„URLï¼ˆå¦‚ `http://æœåŠ¡å™¨IP:8888`ï¼‰
- `LOG_DEVICE_NAME`: è®¾å¤‡åç§°ï¼ˆ`server`/`jetson`/`nuc`ï¼‰
- `LOG_SERVER_HOST`: æ—¥å¿—æœåŠ¡å™¨ç›‘å¬åœ°å€ï¼ˆé»˜è®¤ `0.0.0.0`ï¼‰
- `LOG_SERVER_PORT`: æ—¥å¿—æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤ `8888`ï¼‰

**æ•°æ®åº“ï¼š** SQLite (`log_server/logs.db`)ï¼Œé»˜è®¤ä¿ç•™30å¤©ï¼Œå¯é€šè¿‡APIæ¸…ç†

### 7.8 APIæ¥å£

**ä¸»è¦æ¥å£ï¼š**
- `POST /api/logs` - æ¥æ”¶æ—¥å¿—ï¼ˆå®¢æˆ·ç«¯è‡ªåŠ¨è°ƒç”¨ï¼‰
- `GET /api/logs/query` - æŸ¥è¯¢æ—¥å¿—ï¼ˆæ”¯æŒè®¾å¤‡ã€æ¨¡å—ã€çº§åˆ«ã€Request IDã€å…³é”®è¯ç­›é€‰ï¼‰
- `GET /api/logs/stats` - è·å–ç»Ÿè®¡ä¿¡æ¯
- `GET /api/modules` - è·å–æ¨¡å—åˆ—è¡¨
- `POST /api/cleanup?days=30` - æ¸…ç†æ—§æ—¥å¿—

è¯¦ç»†APIæ–‡æ¡£å‚è€ƒ `log_server/app.py`

### 7.9 æ€§èƒ½ä¸å®¹é”™

**æ€§èƒ½ç‰¹ç‚¹ï¼š**
- æ—¥å¿—è®°å½•å¼€é”€ï¼š< 0.1msï¼ˆä»…æ”¾å…¥é˜Ÿåˆ—ï¼Œç«‹å³è¿”å›ï¼‰
- é˜Ÿåˆ—å®¹é‡ï¼šé»˜è®¤1000æ¡ï¼Œæ»¡æ—¶è‡ªåŠ¨ä¸¢å¼ƒæ—§æ—¥å¿—
- ç½‘ç»œè¶…æ—¶ï¼š0.5ç§’ï¼Œå¿«é€Ÿå¤±è´¥
- **ä¸»ä¸šåŠ¡å½±å“ï¼šé›¶å½±å“**ï¼Œå³ä½¿æ—¥å¿—æœåŠ¡å™¨å®Œå…¨ä¸å¯ç”¨ä¹Ÿä¸å½±å“ä¸»ç¨‹åº

**å®¹é”™è®¾è®¡ï¼š**
- ç½‘ç»œå¤±è´¥ï¼šé™é»˜ä¸¢å¼ƒï¼Œç»§ç»­å°è¯•
- æ•°æ®åº“å¤±è´¥ï¼šè¿”å›200ï¼Œé¿å…å®¢æˆ·ç«¯é‡è¯•
- é˜Ÿåˆ—æ»¡ï¼šè‡ªåŠ¨ä¸¢å¼ƒæ—§æ—¥å¿—ï¼Œæ–°æ—¥å¿—ç»§ç»­è®°å½•

### 7.10 æ•…éšœæ’æŸ¥

**å¸¸è§é—®é¢˜ï¼š**

1. **æ—¥å¿—æœªæ˜¾ç¤º**
   - æ£€æŸ¥ `LOG_SERVER_URL` ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®
   - æ£€æŸ¥æ—¥å¿—æœåŠ¡å™¨æ˜¯å¦è¿è¡Œï¼š`curl http://æœåŠ¡å™¨IP:8888/api/logs/stats`
   - æ³¨æ„ï¼šæ—¥å¿—æœåŠ¡å™¨ä¸å¯ç”¨æ—¶ï¼Œæ—¥å¿—ä¼šé™é»˜ä¸¢å¼ƒï¼Œä¸å½±å“ä¸»ç¨‹åº

2. **Webç•Œé¢æ— æ³•è®¿é—®**
   - æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾8888ç«¯å£
   - æ£€æŸ¥æ—¥å¿—æœåŠ¡å™¨è¿›ç¨‹ï¼š`ps aux | grep app.py`

3. **æ•°æ®åº“æ–‡ä»¶è¿‡å¤§**
   - è¿è¡Œæ¸…ç†ï¼š`curl -X POST "http://æœåŠ¡å™¨IP:8888/api/cleanup?days=7"`

**æ€§èƒ½å½±å“ï¼š** é›¶å½±å“ï¼ˆè¯¦è§ 7.9 èŠ‚ï¼‰

### 7.11 ç›®å½•ç»“æ„

```
log_server/
â”œâ”€â”€ app.py              # Flaskåº”ç”¨ï¼ˆæ—¥å¿—æ¥æ”¶+Webå‰ç«¯ï¼‰
â”œâ”€â”€ templates/          # HTMLæ¨¡æ¿
â”œâ”€â”€ static/             # é™æ€æ–‡ä»¶
â”œâ”€â”€ logs.db             # SQLiteæ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â””â”€â”€ start_log_server.sh # å¯åŠ¨è„šæœ¬
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v2.3  
**æœ€åæ›´æ–°ï¼š** 2025-11-20  
**ä½œè€…ï¼š** enemy1205@qq.com

**æ›´æ–°è¯´æ˜ï¼š**
- v2.3 (2025-11-20): æ›´æ–°ä¸ºç®€åŒ–ç‰ˆå®ç°ï¼Œä½¿ç”¨é˜Ÿåˆ—+å•çº¿ç¨‹ï¼Œç§»é™¤å¤æ‚çš„å¥åº·æ£€æŸ¥å’Œæ‰¹é‡æ¨é€æœºåˆ¶
- v2.2 (2025-11-10): æ·»åŠ é›†ä¸­å¼æ—¥å¿—ç®¡ç†æ–¹æ¡ˆ
- v2.1: åˆå§‹ç‰ˆæœ¬

---

## é™„å½•Aï¼šå¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/pipeline.log
tail -f logs/http_agent_server.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" logs/*.log

# è¿½è¸ªç‰¹å®šè¯·æ±‚
grep "ReqID:a1b2c3d4" logs/*.log

# ç»Ÿè®¡æ—¥å¿—é‡
wc -l logs/*.log

# æ¸…ç†æ—§æ—¥å¿—
find logs/ -name "*.log*" -mtime +30 -delete

# åˆ†æå“åº”æ—¶é—´
grep "è€—æ—¶" logs/*.log | awk -F"è€—æ—¶: " '{print $2}' | sort -n

# è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼ˆä¸´æ—¶ï¼‰
export LOG_LEVEL=DEBUG
python3 pipeline.py

# ä½¿ç”¨å¯åŠ¨è„šæœ¬è°ƒæ•´æ—¥å¿—çº§åˆ«
./start_server.sh --log-level DEBUG
```

### å¸¸ç”¨ä»£ç ç‰‡æ®µ

```python
# åˆ›å»ºloggerï¼ˆæœºå™¨äººç«¯ï¼‰
import os
from logger_config import create_robot_logger
logger = create_robot_logger("my_module", level=os.getenv("LOG_LEVEL", "INFO"))

# åˆ›å»ºloggerï¼ˆæœåŠ¡ç«¯ï¼‰
from logger_config import create_server_logger
logger = create_server_logger("my_module", level=os.getenv("LOG_LEVEL", "INFO"))

# è®¾ç½®è¯·æ±‚IDï¼ˆæœåŠ¡ç«¯HTTPè¯·æ±‚ï¼‰
import uuid
from logger_config import set_request_id
request_id = str(uuid.uuid4())[:8]
set_request_id(request_id)

# è®°å½•HTTPè¯·æ±‚
from logger_config import log_request_start, log_request_end
log_request_start(logger, "/api/endpoint", "POST")
# ... å¤„ç†ä¸šåŠ¡é€»è¾‘ ...
log_request_end(logger, 200)  # çŠ¶æ€ç 

# è®°å½•å·¥å…·è°ƒç”¨
from logger_config import log_tool_call
log_tool_call(logger, "go_to_office", {"x": 74.814, "y": 77.791})

# è®°å½•MQTTæ¶ˆæ¯
from logger_config import log_mqtt_publish, log_mqtt_receive
log_mqtt_publish(logger, "robot/navigation", '{"x": 74.814, "y": 77.791}')
log_mqtt_receive(logger, "robot/navigation", '{"x": 74.814, "y": 77.791}')

# è®°å½•å¼‚å¸¸ï¼ˆåŒ…å«å®Œæ•´tracebackï¼‰
try:
    some_function()
except Exception as e:
    logger.error(f"å¤„ç†å¤±è´¥: {e}", exc_info=True)

# æ¡ä»¶æ—¥å¿—ï¼ˆé«˜æ€§èƒ½åœºæ™¯ï¼‰
if logger.isEnabledFor(logging.DEBUG):
    logger.debug(f"è¯¦ç»†æ•°æ®: {large_object}")
```

---


