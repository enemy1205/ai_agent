# è¯­éŸ³æ§åˆ¶æ™ºèƒ½æœºå™¨äººç³»ç»Ÿ - æ¥å£ä¸æ—¥å¿—è§„èŒƒè®¾è®¡

## 1. æ–‡æ¡£è¯´æ˜

### 1.1 ç›®çš„

æœ¬æ–‡æ¡£æ—¨åœ¨è§„èŒƒåŒ–ç³»ç»Ÿå†…æ‰€æœ‰æ¨¡å—é—´çš„æ¥å£é€šä¿¡æ ¼å¼å’Œæ—¥å¿—è¾“å‡ºæ ‡å‡†ï¼Œç¡®ä¿ï¼š
- æ¥å£å®šä¹‰æ¸…æ™°ã€ä¸€è‡´ã€æ˜“äºç»´æŠ¤
- æ—¥å¿—æ ¼å¼ç»Ÿä¸€ã€ä¿¡æ¯å®Œæ•´ã€ä¾¿äºè¿½è¸ª
- é—®é¢˜æ’æŸ¥é«˜æ•ˆã€ç³»ç»Ÿç›‘æ§ä¾¿æ·

### 1.2 é€‚ç”¨èŒƒå›´

- æœºå™¨äººç«¯ï¼špipeline.py, mqtt_manager.py
- æœåŠ¡ç«¯ï¼švoice_services.py, http_agent_server.py, robot_tools.py
- é€šä¿¡åè®®ï¼šHTTP RESTful API, MQTT

### 1.3 ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®è®¢å†…å®¹ | ä½œè€… |
|-----|------|---------|------|
| v1.0 | 2025-11-05 | åˆå§‹ç‰ˆæœ¬ | AI Agent Team |

---

## 2. HTTPæ¥å£è§„èŒƒ

### 2.1 é€šç”¨è§„èŒƒ

#### 2.1.1 åŸºæœ¬åŸåˆ™

1. **RESTfulè®¾è®¡**ï¼šä½¿ç”¨æ ‡å‡†HTTPæ–¹æ³•ï¼ˆGET, POST, PUT, DELETEï¼‰
2. **JSONæ ¼å¼**ï¼šè¯·æ±‚å’Œå“åº”ç»Ÿä¸€ä½¿ç”¨JSONæ ¼å¼
3. **UTF-8ç¼–ç **ï¼šæ‰€æœ‰æ–‡æœ¬å†…å®¹ä½¿ç”¨UTF-8ç¼–ç 
4. **çŠ¶æ€ç è¯­ä¹‰åŒ–**ï¼šæ­£ç¡®ä½¿ç”¨HTTPçŠ¶æ€ç 
5. **é”™è¯¯å¤„ç†ç»Ÿä¸€**ï¼šé”™è¯¯å“åº”æ ¼å¼ä¸€è‡´

#### 2.1.2 è¯·æ±‚å¤´è§„èŒƒ

**å¿…éœ€è¯·æ±‚å¤´ï¼š**
```http
Content-Type: application/json
Accept: application/json
```

**å¯é€‰è¯·æ±‚å¤´ï¼š**
```http
X-Request-ID: <å”¯ä¸€è¯·æ±‚æ ‡è¯†>
User-Agent: <å®¢æˆ·ç«¯æ ‡è¯†>
```

#### 2.1.3 å“åº”æ ¼å¼è§„èŒƒ

**æˆåŠŸå“åº”æ ¼å¼ï¼š**

```json
{
  "success": true,
  "data": {
    // å®é™…æ•°æ®
  },
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2025-11-05T10:30:00Z",
  "request_id": "req_1699876543"
}
```

**é”™è¯¯å“åº”æ ¼å¼ï¼š**

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "é”™è¯¯æè¿°ä¿¡æ¯",
    "details": "è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"
  },
  "timestamp": "2025-11-05T10:30:00Z",
  "request_id": "req_1699876543"
}
```

#### 2.1.4 HTTPçŠ¶æ€ç ä½¿ç”¨è§„èŒƒ

| çŠ¶æ€ç  | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|-------|------|----------|
| 200 | OK | è¯·æ±‚æˆåŠŸ |
| 400 | Bad Request | è¯·æ±‚å‚æ•°é”™è¯¯ã€æ ¼å¼é”™è¯¯ |
| 401 | Unauthorized | è®¤è¯å¤±è´¥ |
| 403 | Forbidden | æƒé™ä¸è¶³ |
| 404 | Not Found | èµ„æºä¸å­˜åœ¨ |
| 500 | Internal Server Error | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 503 | Service Unavailable | æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ |

---

### 2.2 è¯­éŸ³æœåŠ¡æ¥å£è§„èŒƒ (voice_services.py)

**åŸºç¡€URLï¼š** `http://{VOICE_SERVER_IP}:{VOICE_SERVER_PORT}`

#### 2.2.1 å¥åº·æ£€æŸ¥

**ç«¯ç‚¹ï¼š** `GET /`

**åŠŸèƒ½ï¼š** æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET / HTTP/1.1
Host: 202.38.214.151:4999
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "message": "ç»Ÿä¸€è¯­éŸ³æœåŠ¡èŠ‚ç‚¹å·²å¯åŠ¨",
  "status": "OK",
  "endpoints": {
    "asr": "/asr/recognize",
    "tts": "/tts/synthesize",
    "speaker_register": "/speaker/register",
    "speaker_verify": "/speaker/verify"
  }
}
```

**çŠ¶æ€ç ï¼š**
- 200: æœåŠ¡æ­£å¸¸

---

#### 2.2.2 è¯­éŸ³è¯†åˆ« (ASR)

**ç«¯ç‚¹ï¼š** `POST /asr/recognize`

**åŠŸèƒ½ï¼š** å°†éŸ³é¢‘æ•°æ®è½¬æ¢ä¸ºæ–‡å­—

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-------|------|------|------|
| audio_base64 | string | æ˜¯ | Base64ç¼–ç çš„WAVéŸ³é¢‘æ•°æ® |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "audio_base64": "UklGRiQAAABXQVZFZm10IBAAAAABAAEA..."
}
```

**éŸ³é¢‘è¦æ±‚ï¼š**
- æ ¼å¼ï¼šWAV (PCM)
- é‡‡æ ·ç‡ï¼š16000 Hz
- å£°é“ï¼šå•å£°é“ (Mono)
- ä½æ·±åº¦ï¼š16-bit
- ç¼–ç ï¼šBase64

**æˆåŠŸå“åº”ï¼š**
```json
{
  "success": true,
  "result": "å»åŠå…¬å®¤æ‹¿æ°´ç“¶",
  "request_id": "asr_1699876543",
  "duration": 3.5
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**
- `success`: å¸ƒå°”å€¼ï¼Œæ˜¯å¦è¯†åˆ«æˆåŠŸ
- `result`: å­—ç¬¦ä¸²ï¼Œè¯†åˆ«ç»“æœæ–‡æœ¬
- `request_id`: å­—ç¬¦ä¸²ï¼Œè¯·æ±‚å”¯ä¸€æ ‡è¯†
- `duration`: æµ®ç‚¹æ•°ï¼ŒéŸ³é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œå¯é€‰

**é”™è¯¯å“åº”ï¼š**
```json
{
  "success": false,
  "error": "ç¼ºå°‘ 'audio_base64' å­—æ®µ"
}
```

**çŠ¶æ€ç ï¼š**
- 200: è¯†åˆ«æˆåŠŸï¼ˆsuccess=trueï¼‰æˆ–è¯†åˆ«å¤±è´¥ï¼ˆsuccess=falseï¼‰
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

**é”™è¯¯ç ï¼š**
- `MISSING_AUDIO`: ç¼ºå°‘éŸ³é¢‘æ•°æ®
- `INVALID_AUDIO_FORMAT`: éŸ³é¢‘æ ¼å¼é”™è¯¯
- `ASR_SERVICE_ERROR`: ASRæœåŠ¡è°ƒç”¨å¤±è´¥
- `DECODE_ERROR`: Base64è§£ç å¤±è´¥

---

#### 2.2.3 è¯­éŸ³åˆæˆ (TTS)

**ç«¯ç‚¹ï¼š** `POST /tts/synthesize`

**åŠŸèƒ½ï¼š** å°†æ–‡å­—è½¬æ¢ä¸ºè¯­éŸ³

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| text | string | æ˜¯ | - | è¦åˆæˆçš„æ–‡æœ¬ |
| voice_type | int | å¦ | 101001 | éŸ³è‰²ç±»å‹ |
| primary_language | int | å¦ | 1 | ä¸»è¦è¯­è¨€ï¼ˆ1=ä¸­æ–‡ï¼‰ |
| sample_rate | int | å¦ | 16000 | é‡‡æ ·ç‡ |
| speed | int | å¦ | 0 | è¯­é€Ÿï¼ˆ-2~6ï¼‰ |
| codec | string | å¦ | "wav" | ç¼–ç æ ¼å¼ï¼ˆwav/mp3/pcmï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "text": "å¥½çš„ï¼Œæˆ‘ç°åœ¨å»åŠå…¬å®¤æ‹¿æ°´ç“¶",
  "voice_type": 101001,
  "sample_rate": 16000,
  "speed": 0,
  "codec": "wav"
}
```

**éŸ³è‰²ç±»å‹å‚è€ƒï¼š**
- 101001: æ™ºç‘œï¼ˆå¥³å£°ï¼Œé€šç”¨ï¼‰
- 101002: æ™ºè†ï¼ˆå¥³å£°ï¼Œå®¢æœï¼‰
- 101003: æ™ºç¾ï¼ˆå¥³å£°ï¼Œæ¸©æŸ”ï¼‰
- æ›´å¤šå‚è€ƒè…¾è®¯äº‘TTSæ–‡æ¡£

**æˆåŠŸå“åº”ï¼š**
```json
{
  "success": true,
  "message": "è¯­éŸ³åˆæˆæˆåŠŸ",
  "audio_base64": "UklGRiQAAABXQVZFZm10IBAAAAABAAEA...",
  "session_id": "tts_service_1699876543000",
  "sample_rate": 16000,
  "codec": "wav"
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**
- `success`: å¸ƒå°”å€¼ï¼Œæ˜¯å¦åˆæˆæˆåŠŸ
- `message`: å­—ç¬¦ä¸²ï¼Œæ“ä½œç»“æœæè¿°
- `audio_base64`: å­—ç¬¦ä¸²ï¼ŒBase64ç¼–ç çš„éŸ³é¢‘æ•°æ®
- `session_id`: å­—ç¬¦ä¸²ï¼Œä¼šè¯å”¯ä¸€æ ‡è¯†
- `sample_rate`: æ•´æ•°ï¼Œé‡‡æ ·ç‡
- `codec`: å­—ç¬¦ä¸²ï¼ŒéŸ³é¢‘ç¼–ç æ ¼å¼

**é”™è¯¯å“åº”ï¼š**
```json
{
  "success": false,
  "error": "è¯·æ±‚ä¸­ç¼ºå°‘ 'text' å­—æ®µæˆ–æ–‡æœ¬ä¸ºç©º"
}
```

**çŠ¶æ€ç ï¼š**
- 200: åˆæˆæˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

**é”™è¯¯ç ï¼š**
- `MISSING_TEXT`: ç¼ºå°‘æ–‡æœ¬å†…å®¹
- `INVALID_CODEC`: ä¸æ”¯æŒçš„ç¼–ç æ ¼å¼
- `TTS_SERVICE_ERROR`: TTSæœåŠ¡è°ƒç”¨å¤±è´¥

---

#### 2.2.4 å£°çº¹æ³¨å†Œ

**ç«¯ç‚¹ï¼š** `POST /speaker/register`

**åŠŸèƒ½ï¼š** æ³¨å†Œç”¨æˆ·å£°çº¹ç‰¹å¾

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-------|------|------|------|
| id | string | æ˜¯ | ç”¨æˆ·å”¯ä¸€æ ‡è¯† |
| audio_base64 | string | æ˜¯ | Base64ç¼–ç çš„éŸ³é¢‘æ•°æ® |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "id": "user_1699876543",
  "audio_base64": "UklGRiQAAABXQVZFZm10IBAAAAABAAEA..."
}
```

**éŸ³é¢‘è¦æ±‚ï¼š**
- æ—¶é•¿ï¼šå»ºè®®3-5ç§’
- å†…å®¹ï¼šæ¸…æ™°çš„è¯­éŸ³ï¼ˆå»ºè®®æœ—è¯»å›ºå®šæ–‡æœ¬ï¼‰
- æ ¼å¼ï¼šåŒASRè¦æ±‚ï¼ˆWAV, 16kHz, Mono, 16-bitï¼‰

**æˆåŠŸå“åº”ï¼š**
```json
{
  "success": true,
  "id": "user_1699876543",
  "path": "/path/to/speaker_db/user_1699876543.npy"
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**
- `success`: å¸ƒå°”å€¼ï¼Œæ˜¯å¦æ³¨å†ŒæˆåŠŸ
- `id`: å­—ç¬¦ä¸²ï¼Œç”¨æˆ·ID
- `path`: å­—ç¬¦ä¸²ï¼Œå£°çº¹ç‰¹å¾æ–‡ä»¶å­˜å‚¨è·¯å¾„

**é”™è¯¯å“åº”ï¼š**
```json
{
  "success": false,
  "error": "ç¼ºå°‘ 'id'"
}
```

**çŠ¶æ€ç ï¼š**
- 200: æ³¨å†ŒæˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

**é”™è¯¯ç ï¼š**
- `MISSING_ID`: ç¼ºå°‘ç”¨æˆ·ID
- `MISSING_AUDIO`: ç¼ºå°‘éŸ³é¢‘æ•°æ®
- `DUPLICATE_ID`: ç”¨æˆ·IDå·²å­˜åœ¨
- `FEATURE_EXTRACTION_ERROR`: å£°çº¹ç‰¹å¾æå–å¤±è´¥

---

#### 2.2.5 å£°çº¹è®¤è¯

**ç«¯ç‚¹ï¼š** `POST /speaker/verify`

**åŠŸèƒ½ï¼š** éªŒè¯ç”¨æˆ·èº«ä»½

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| audio_base64 | string | æ˜¯ | - | Base64ç¼–ç çš„éŸ³é¢‘æ•°æ® |
| threshold | float | å¦ | 0.62 | ç›¸ä¼¼åº¦é˜ˆå€¼ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "audio_base64": "UklGRiQAAABXQVZFZm10IBAAAAABAAEA...",
  "threshold": 0.62
}
```

**æˆåŠŸå“åº”ï¼š**
```json
{
  "success": true,
  "id": "user_1699876543",
  "confidence": 0.85,
  "threshold": 0.62,
  "registered": true
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**
- `success`: å¸ƒå°”å€¼ï¼Œè¯·æ±‚æ˜¯å¦æˆåŠŸ
- `id`: å­—ç¬¦ä¸²ï¼ŒåŒ¹é…çš„ç”¨æˆ·IDï¼ˆæœªåŒ¹é…æ—¶ä¸º"UNREGISTERED"ï¼‰
- `confidence`: æµ®ç‚¹æ•°ï¼Œç›¸ä¼¼åº¦ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰
- `threshold`: æµ®ç‚¹æ•°ï¼Œä½¿ç”¨çš„é˜ˆå€¼
- `registered`: å¸ƒå°”å€¼ï¼Œæ˜¯å¦é€šè¿‡è®¤è¯

**æœªæ³¨å†Œç”¨æˆ·å“åº”ï¼š**
```json
{
  "success": true,
  "id": "UNREGISTERED",
  "confidence": 0.35,
  "threshold": 0.62,
  "registered": false
}
```

**é”™è¯¯å“åº”ï¼š**
```json
{
  "success": false,
  "error": "ç¼ºå°‘ 'audio_base64'"
}
```

**çŠ¶æ€ç ï¼š**
- 200: è®¤è¯æˆåŠŸï¼ˆæ— è®ºæ˜¯å¦åŒ¹é…ï¼‰
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

**é˜ˆå€¼å»ºè®®ï¼š**
- 0.50-0.60: å®½æ¾æ¨¡å¼ï¼ˆé«˜å¬å›ç‡ï¼‰
- 0.60-0.70: å¹³è¡¡æ¨¡å¼ï¼ˆæ¨èï¼‰
- 0.70-0.85: ä¸¥æ ¼æ¨¡å¼ï¼ˆé«˜ç²¾ç¡®åº¦ï¼‰

---

### 2.3 AI Agentæ¥å£è§„èŒƒ (http_agent_server.py)

**åŸºç¡€URLï¼š** `http://{LLM_SERVER_IP}:{LLM_SERVER_PORT}`

#### 2.3.1 å¥åº·æ£€æŸ¥

**ç«¯ç‚¹ï¼š** `GET /health`

**åŠŸèƒ½ï¼š** æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /health HTTP/1.1
Host: 202.38.214.151:5000
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": "healthy",
  "message": "HTTP Agent Serveræ­£åœ¨è¿è¡Œ",
  "tools_available": [
    "arm_control",
    "go_to_office",
    "go_to_restroom",
    "go_to_corridor",
    "complex_task",
    "gripper_control",
    "get_water_bottle"
  ]
}
```

**çŠ¶æ€ç ï¼š**
- 200: æœåŠ¡æ­£å¸¸

---

#### 2.3.2 æ–‡æœ¬è¡¥å…¨æ¥å£ (Completions)

**ç«¯ç‚¹ï¼š** `POST /v1/completions`

**åŠŸèƒ½ï¼š** å…¼å®¹OpenAI APIçš„æ–‡æœ¬è¡¥å…¨æ¥å£

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| prompt | string | æ˜¯ | - | è¾“å…¥æç¤ºè¯ |
| stop | array | å¦ | [] | åœæ­¢åºåˆ— |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "prompt": "Human: å»åŠå…¬å®¤æ‹¿æ°´ç“¶\nAssistant:",
  "stop": ["\n\n", "Human:", "Assistant:"]
}
```

**Promptæ ¼å¼å»ºè®®ï¼š**

å¯¹äºå¯¹è¯ä»»åŠ¡ï¼š
```
Human: <ç”¨æˆ·è¾“å…¥>
Assistant:
```

å¯¹äºå¤šè½®å¯¹è¯ï¼š
```
Human: <å†å²è¾“å…¥1>
Assistant: <å†å²å›å¤1>
Human: <å†å²è¾“å…¥2>
Assistant: <å†å²å›å¤2>
Human: <å½“å‰è¾“å…¥>
Assistant:
```

**æˆåŠŸå“åº”ï¼š**
```json
{
  "choices": [
    {
      "text": "å¥½çš„ï¼Œæˆ‘ç°åœ¨å»åŠå…¬å®¤æ‹¿æ°´ç“¶\n\nå·²å‘é€æœºæ¢°è‡‚ã€å¤¹å–ã€æŒ‡ä»¤",
      "index": 0,
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 15,
    "completion_tokens": 25,
    "total_tokens": 40
  },
  "model": "local-agent",
  "object": "text_completion"
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**
- `choices`: æ•°ç»„ï¼Œç”Ÿæˆçš„å›å¤åˆ—è¡¨
  - `text`: å­—ç¬¦ä¸²ï¼Œç”Ÿæˆçš„æ–‡æœ¬ï¼ˆåŒ…å«å·¥å…·æ‰§è¡Œç»“æœï¼‰
  - `index`: æ•´æ•°ï¼Œå›å¤ç´¢å¼•
  - `finish_reason`: å­—ç¬¦ä¸²ï¼Œç»“æŸåŸå› ï¼ˆstop/length/errorï¼‰
- `usage`: å¯¹è±¡ï¼Œtokenä½¿ç”¨ç»Ÿè®¡
- `model`: å­—ç¬¦ä¸²ï¼Œæ¨¡å‹æ ‡è¯†
- `object`: å­—ç¬¦ä¸²ï¼Œå¯¹è±¡ç±»å‹æ ‡è¯†

**å·¥å…·è°ƒç”¨å“åº”ç¤ºä¾‹ï¼š**

å½“Agentè°ƒç”¨äº†å·¥å…·æ—¶ï¼Œå“åº”çš„textå­—æ®µä¼šåŒ…å«å·¥å…·æ‰§è¡Œç»“æœï¼š

```json
{
  "choices": [
    {
      "text": "å¥½çš„ï¼Œæˆ‘ç°åœ¨å»åŠå…¬å®¤æ‹¿æ°´ç“¶\n\nå·²å‘é€å‰å¾€ã€åŠå…¬å®¤ã€çš„å¯¼èˆªæŒ‡ä»¤\nå·²å‘é€æœºæ¢°è‡‚ã€å¤¹å–ã€æŒ‡ä»¤",
      "index": 0,
      "finish_reason": "stop"
    }
  ]
}
```

**é”™è¯¯å“åº”ï¼š**
```json
{
  "error": "æœªæä¾›prompt",
  "choices": [
    {
      "text": "æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„è¯·æ±‚æ—¶å‡ºç°é”™è¯¯ï¼šæœªæä¾›prompt",
      "index": 0,
      "finish_reason": "error"
    }
  ]
}
```

**çŠ¶æ€ç ï¼š**
- 200: è¯·æ±‚æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

#### 2.3.3 èŠå¤©è¡¥å…¨æ¥å£ (Chat Completions)

**ç«¯ç‚¹ï¼š** `POST /v1/chat/completions`

**åŠŸèƒ½ï¼š** å…¼å®¹OpenAI APIçš„èŠå¤©è¡¥å…¨æ¥å£

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-------|------|------|------|
| messages | array | æ˜¯ | æ¶ˆæ¯åˆ—è¡¨ |

**æ¶ˆæ¯æ ¼å¼ï¼š**
```json
{
  "role": "user|assistant|system",
  "content": "æ¶ˆæ¯å†…å®¹"
}
```

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "messages": [
    {
      "role": "user",
      "content": "ä½ å¥½"
    },
    {
      "role": "assistant",
      "content": "ä½ å¥½ï¼æˆ‘æ˜¯Siriï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ"
    },
    {
      "role": "user",
      "content": "å»åŠå…¬å®¤æ‹¿æ°´ç“¶"
    }
  ]
}
```

**æˆåŠŸå“åº”ï¼š**
```json
{
  "choices": [
    {
      "message": {
        "role": "assistant",
        "content": "å¥½çš„ï¼Œæˆ‘ç°åœ¨å»åŠå…¬å®¤æ‹¿æ°´ç“¶"
      },
      "index": 0,
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 30,
    "completion_tokens": 15,
    "total_tokens": 45
  },
  "model": "local-agent",
  "object": "chat.completion"
}
```

**çŠ¶æ€ç ï¼š**
- 200: è¯·æ±‚æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

#### 2.3.4 å·¥å…·åˆ—è¡¨æŸ¥è¯¢

**ç«¯ç‚¹ï¼š** `GET /tools`

**åŠŸèƒ½ï¼š** è·å–å¯ç”¨å·¥å…·åˆ—è¡¨

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /tools HTTP/1.1
Host: 202.38.214.151:5000
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "tools": [
    {
      "name": "arm_control",
      "description": "ä»…æ§åˆ¶æœºæ¢°è‡‚å§¿æ€ä¸åŠ¨ä½œ..."
    },
    {
      "name": "go_to_office",
      "description": "ä»…åœ¨ç”¨æˆ·æ˜ç¡®è¡¨è¾¾è¦å‰å¾€åŠå…¬å®¤æ—¶ä½¿ç”¨..."
    }
  ],
  "count": 7
}
```

**çŠ¶æ€ç ï¼š**
- 200: æŸ¥è¯¢æˆåŠŸ

---

#### 2.3.5 æœåŠ¡çŠ¶æ€æŸ¥è¯¢

**ç«¯ç‚¹ï¼š** `GET /status`

**åŠŸèƒ½ï¼š** è·å–æœåŠ¡è¿è¡ŒçŠ¶æ€

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
GET /status HTTP/1.1
Host: 202.38.214.151:5000
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": "running",
  "agent_initialized": true,
  "base_directory": "/home/sp/projects/ai_agent",
  "available_tools": [
    "arm_control",
    "go_to_office",
    "go_to_restroom",
    "go_to_corridor",
    "complex_task",
    "gripper_control",
    "get_water_bottle"
  ]
}
```

**çŠ¶æ€ç ï¼š**
- 200: æŸ¥è¯¢æˆåŠŸ

---

## 3. MQTTæ¥å£è§„èŒƒ

### 3.1 é€šç”¨è§„èŒƒ

#### 3.1.1 åŸºæœ¬é…ç½®

**Brokeré…ç½®ï¼š**
- æœåŠ¡ç«¯å‘é€åœ°å€ï¼š10.194.142.104:1883
- æœºå™¨äººç«¯æ¥æ”¶åœ°å€ï¼š127.0.0.1:1883
- QoSçº§åˆ«ï¼š1ï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰
- Keep Aliveï¼š60ç§’

**å®¢æˆ·ç«¯IDè§„èŒƒï¼š**
```
æ ¼å¼: {client_type}_{identifier}
ç¤ºä¾‹: nav_sender_10.194.142.104
     nav_receiver_192.168.1.100
```

#### 3.1.2 ä¸»é¢˜å‘½åè§„èŒƒ

**æ ¼å¼ï¼š** `robot/{category}/{action}`

**å·²å®šä¹‰ä¸»é¢˜ï¼š**
- `robot/navigation` - å¯¼èˆªæ§åˆ¶
- `robot/arm/control` - æœºæ¢°è‡‚å‘½ä»¤æ§åˆ¶
- `robot/arm/coordinate` - æœºæ¢°è‡‚åæ ‡æ§åˆ¶
- `robot/gripper/control` - å¤¹çˆªæ§åˆ¶
- `robot/navigation_status` - å¯¼èˆªçŠ¶æ€åé¦ˆï¼ˆé¢„ç•™ï¼‰

#### 3.1.3 æ¶ˆæ¯æ ¼å¼è§„èŒƒ

**Payloadæ ¼å¼ï¼š** JSONå­—ç¬¦ä¸²

**é€šç”¨å­—æ®µï¼š**
```json
{
  "timestamp": 1699876543.123,  // å¯é€‰ï¼šæ—¶é—´æˆ³
  "seq": 1,                      // å¯é€‰ï¼šåºåˆ—å·
  "source": "robot_tools",       // å¯é€‰ï¼šæ¥æºæ ‡è¯†
  // å…·ä½“æŒ‡ä»¤å­—æ®µ...
}
```

---

### 3.2 å¯¼èˆªæ§åˆ¶æ¶ˆæ¯

**ä¸»é¢˜ï¼š** `robot/navigation`

**æ¶ˆæ¯æ ¼å¼ï¼š**

```json
{
  "x": 96.08911,
  "y": 97.93042,
  "z": 0.0,
  "orientation": {
    "x": 0.0,
    "y": 0.0,
    "z": 0.04649,
    "w": -0.99892
  }
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|------|------|------|
| x | float | æ˜¯ | ç›®æ ‡ä½ç½®Xåæ ‡ï¼ˆç±³ï¼‰ |
| y | float | æ˜¯ | ç›®æ ‡ä½ç½®Yåæ ‡ï¼ˆç±³ï¼‰ |
| z | float | æ˜¯ | ç›®æ ‡ä½ç½®Zåæ ‡ï¼ˆç±³ï¼‰ |
| orientation | object | å¦ | ç›®æ ‡æœå‘ï¼ˆå››å…ƒæ•°ï¼‰ |
| orientation.x | float | å¦ | å››å…ƒæ•°xåˆ†é‡ |
| orientation.y | float | å¦ | å››å…ƒæ•°yåˆ†é‡ |
| orientation.z | float | å¦ | å››å…ƒæ•°zåˆ†é‡ |
| orientation.w | float | å¦ | å››å…ƒæ•°wåˆ†é‡ |

**æœå‘è¯´æ˜ï¼š**
- å¦‚æœä¸æä¾›orientationï¼Œä½¿ç”¨é»˜è®¤æœå‘(0, 0, 0, 1)
- å››å…ƒæ•°å¿…é¡»å½’ä¸€åŒ–ï¼šxÂ² + yÂ² + zÂ² + wÂ² = 1

**ç¤ºä¾‹1ï¼šå¯¼èˆªåˆ°æŒ‡å®šä½ç½®ï¼ˆé»˜è®¤æœå‘ï¼‰**
```json
{
  "x": 74.814,
  "y": 77.791,
  "z": 0.0
}
```

**ç¤ºä¾‹2ï¼šå¯¼èˆªåˆ°æŒ‡å®šä½ç½®å’Œæœå‘**
```json
{
  "x": 86.846,
  "y": 92.542,
  "z": 0.0,
  "orientation": {
    "x": 0.0,
    "y": 0.0,
    "z": 0.707,
    "w": 0.707
  }
}
```

---

### 3.3 æœºæ¢°è‡‚å‘½ä»¤æ§åˆ¶æ¶ˆæ¯

**ä¸»é¢˜ï¼š** `robot/arm/control`

**æ¶ˆæ¯æ ¼å¼ï¼š**

```json
{
  "command": 1
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|------|------|------|
| command | int | æ˜¯ | æœºæ¢°è‡‚å‘½ä»¤ç  |

**å‘½ä»¤ç å®šä¹‰ï¼š**

| å‘½ä»¤ç  | åç§° | åŠŸèƒ½ | ä½ç½®å‚æ•° |
|-------|------|------|---------|
| 0 | å½’ä½ | æœºæ¢°è‡‚å›åˆ°åˆå§‹ä½ç½® | (-183.396, 32.867, -100.611)<br>(-7.378, 89.048, 0) |
| 1 | å¤¹å–å§¿æ€ | ç§»åŠ¨åˆ°å¤¹å–é¢„å¤‡ä½ç½® | (-92.346, -50.122, -53.531)<br>(17.066, 89.044, 0) |
| 2 | é‡Šæ”¾å§¿æ€ | ç§»åŠ¨åˆ°é‡Šæ”¾é¢„å¤‡ä½ç½® | (-92.346, -50.122, -53.531)<br>(17.066, 89.044, 0) |
| 3 | æ¬è¿å§¿æ€ | ä¿æŒå½“å‰å§¿æ€ç”¨äºç§»åŠ¨ | (-88.396, 39.867, -100.611)<br>(-7.378, 89.048, 0) |

**ç¤ºä¾‹ï¼šæœºæ¢°è‡‚å½’ä½**
```json
{
  "command": 0
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- å‘½ä»¤ç å¿…é¡»ä¸º0-3ä¹‹é—´çš„æ•´æ•°
- æ— æ•ˆå‘½ä»¤ç å°†è¢«å¿½ç•¥å¹¶è®°å½•è­¦å‘Š

---

### 3.4 æœºæ¢°è‡‚åæ ‡æ§åˆ¶æ¶ˆæ¯

**ä¸»é¢˜ï¼š** `robot/arm/coordinate`

**æ¶ˆæ¯æ ¼å¼ï¼š**

```json
{
  "x": -82.524,
  "y": -36.584,
  "z": -85.549,
  "rx": 93.457,
  "ry": 88.242,
  "rz": 4.331
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | å•ä½ | è¯´æ˜ |
|-----|------|------|------|------|
| x | float | æ˜¯ | mm | æœ«ç«¯æ‰§è¡Œå™¨Xåæ ‡ |
| y | float | æ˜¯ | mm | æœ«ç«¯æ‰§è¡Œå™¨Yåæ ‡ |
| z | float | æ˜¯ | mm | æœ«ç«¯æ‰§è¡Œå™¨Zåæ ‡ |
| rx | float | æ˜¯ | åº¦ | æœ«ç«¯æ‰§è¡Œå™¨Rollè§’ |
| ry | float | æ˜¯ | åº¦ | æœ«ç«¯æ‰§è¡Œå™¨Pitchè§’ |
| rz | float | æ˜¯ | åº¦ | æœ«ç«¯æ‰§è¡Œå™¨Yawè§’ |

**åæ ‡ç³»è¯´æ˜ï¼š**
- åŸç‚¹ï¼šæœºæ¢°è‡‚åŸºåº§ä¸­å¿ƒ
- Xè½´ï¼šæœºå™¨äººå‰è¿›æ–¹å‘
- Yè½´ï¼šæœºå™¨äººå·¦ä¾§æ–¹å‘
- Zè½´ï¼šå‚ç›´å‘ä¸Šæ–¹å‘

**è§’åº¦èŒƒå›´ï¼š**
- rx: -180Â° ~ +180Â°
- ry: -90Â° ~ +90Â°
- rz: -180Â° ~ +180Â°

**ç¤ºä¾‹ï¼šç§»åŠ¨åˆ°æŠ“å–ä½ç½®**
```json
{
  "x": -82.524,
  "y": -36.584,
  "z": -85.549,
  "rx": 93.457,
  "ry": 88.242,
  "rz": 4.331
}
```

---

### 3.5 å¤¹çˆªæ§åˆ¶æ¶ˆæ¯

**ä¸»é¢˜ï¼š** `robot/gripper/control`

**æ¶ˆæ¯æ ¼å¼ï¼š**

```json
{
  "command": 1
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|------|------|------|
| command | int | æ˜¯ | å¤¹çˆªå‘½ä»¤ç  |

**å‘½ä»¤ç å®šä¹‰ï¼š**

| å‘½ä»¤ç  | åç§° | åŠŸèƒ½ | è¯´æ˜ |
|-------|------|------|------|
| 1 | å¤¹ç´§ | é—­åˆå¤¹çˆªå¤¹å–ç‰©ä½“ | é€‚ç”¨äºæŠ“å–æ“ä½œ |
| 2 | æ¾å¼€ | æ‰“å¼€å¤¹çˆªé‡Šæ”¾ç‰©ä½“ | é€‚ç”¨äºæ”¾ç½®æ“ä½œ |

**ç¤ºä¾‹1ï¼šå¤¹ç´§**
```json
{
  "command": 1
}
```

**ç¤ºä¾‹2ï¼šæ¾å¼€**
```json
{
  "command": 2
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- å‘½ä»¤ç å¿…é¡»ä¸º1æˆ–2
- æ‰§è¡Œå¤¹çˆªæ“ä½œå‰ç¡®ä¿æœºæ¢°è‡‚å·²åˆ°ä½
- æ— æ•ˆå‘½ä»¤ç å°†è¢«å¿½ç•¥å¹¶è®°å½•è­¦å‘Š

---

### 3.6 MQTTé”™è¯¯å¤„ç†

#### 3.6.1 è¿æ¥å¤±è´¥

**é”™è¯¯åœºæ™¯ï¼š**
- Brokerä¸å¯è¾¾
- ç½‘ç»œæ•…éšœ
- ç«¯å£è¢«å ç”¨

**å¤„ç†ç­–ç•¥ï¼š**
1. è®°å½•é”™è¯¯æ—¥å¿—
2. ç­‰å¾…5ç§’åé‡è¯•
3. æœ€å¤šé‡è¯•3æ¬¡
4. é€šçŸ¥ä¸Šå±‚æœåŠ¡è¿æ¥å¤±è´¥

#### 3.6.2 æ¶ˆæ¯å‘é€å¤±è´¥

**é”™è¯¯åœºæ™¯ï¼š**
- è¿æ¥æ–­å¼€
- QoSè¶…æ—¶
- æ¶ˆæ¯è¿‡å¤§

**å¤„ç†ç­–ç•¥ï¼š**
1. è®°å½•é”™è¯¯æ—¥å¿—
2. è¿”å›å¤±è´¥çŠ¶æ€ç»™è°ƒç”¨æ–¹
3. ä¸è¿›è¡Œè‡ªåŠ¨é‡è¯•ï¼ˆç”±è°ƒç”¨æ–¹å†³å®šï¼‰

#### 3.6.3 æ¶ˆæ¯æ ¼å¼é”™è¯¯

**é”™è¯¯åœºæ™¯ï¼š**
- JSONè§£æå¤±è´¥
- ç¼ºå°‘å¿…éœ€å­—æ®µ
- å­—æ®µç±»å‹é”™è¯¯

**å¤„ç†ç­–ç•¥ï¼š**
1. è®°å½•è­¦å‘Šæ—¥å¿—
2. ä¸¢å¼ƒè¯¥æ¶ˆæ¯
3. ç»§ç»­å¤„ç†åç»­æ¶ˆæ¯

---

## 4. æ—¥å¿—è§„èŒƒ

### 4.1 æ—¥å¿—çº§åˆ«å®šä¹‰

| çº§åˆ« | åç§° | ç”¨é€” | ç¤ºä¾‹åœºæ™¯ |
|-----|------|------|----------|
| DEBUG | è°ƒè¯• | è¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯ | å‡½æ•°è°ƒç”¨å‚æ•°ã€ä¸­é—´å˜é‡å€¼ |
| INFO | ä¿¡æ¯ | å¸¸è§„è¿è¡Œä¿¡æ¯ | æœåŠ¡å¯åŠ¨ã€ä»»åŠ¡å¼€å§‹/å®Œæˆ |
| WARNING | è­¦å‘Š | æ½œåœ¨é—®é¢˜ä½†ä¸å½±å“è¿è¡Œ | å‚æ•°è¶…å‡ºå»ºè®®èŒƒå›´ã€é™çº§æœåŠ¡ |
| ERROR | é”™è¯¯ | åŠŸèƒ½æ€§é”™è¯¯ä½†ä¸å½±å“æ•´ä½“ | APIè°ƒç”¨å¤±è´¥ã€èµ„æºä¸è¶³ |
| CRITICAL | ä¸¥é‡ | ç³»ç»Ÿçº§ä¸¥é‡é”™è¯¯ | æœåŠ¡å´©æºƒã€æ•°æ®æŸå |

### 4.2 æ—¥å¿—æ ¼å¼è§„èŒƒ

#### 4.2.1 æ ‡å‡†æ ¼å¼

**æ ¼å¼æ¨¡æ¿ï¼š**
```
[æ—¶é—´æˆ³] [çº§åˆ«] [æ¨¡å—] [çº¿ç¨‹] - æ¶ˆæ¯å†…å®¹
```

**ç¤ºä¾‹ï¼š**
```
[2025-11-05 10:30:15.123] INFO [pipeline] [MainThread] - ğŸ—£ï¸ è¯†åˆ«ç»“æœ: å»åŠå…¬å®¤æ‹¿æ°´ç“¶
[2025-11-05 10:30:16.456] ERROR [voice_services] [Thread-1] - âŒ ASR æœåŠ¡è°ƒç”¨å¤±è´¥: Connection timeout
```

#### 4.2.2 Pythonæ—¥å¿—é…ç½®

**åŸºç¡€é…ç½®ï¼š**
```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='[%(asctime)s] %(levelname)s [%(name)s] [%(threadName)s] - %(message)s',
    datefmt='%Y-%m-%d %H:%M:%S',
    handlers=[
        logging.StreamHandler(),  # æ§åˆ¶å°è¾“å‡º
        logging.FileHandler('app.log', encoding='utf-8')  # æ–‡ä»¶è¾“å‡º
    ]
)

logger = logging.getLogger(__name__)
```

**ROSç¯å¢ƒé…ç½®ï¼š**
```python
import rospy

# ROSæ—¥å¿—è‡ªåŠ¨åŒ…å«æ—¶é—´æˆ³å’Œçº§åˆ«
rospy.loginfo("å¯¼èˆªä»»åŠ¡å·²å®Œæˆ")
rospy.logwarn("æ£€æµ‹åˆ°æ‰‹æŸ„æ§åˆ¶æ¨¡å¼")
rospy.logerr("MQTTè¿æ¥å¤±è´¥")
```

### 4.3 æ—¥å¿—å†…å®¹è§„èŒƒ

#### 4.3.1 æœåŠ¡å¯åŠ¨æ—¥å¿—

**æ ¼å¼ï¼š**
```
ğŸš€ å¯åŠ¨{æœåŠ¡å}
ğŸ“ ç›‘å¬åœ°å€: {host}:{port}
ğŸ”§ é…ç½®ä¿¡æ¯: {å…³é”®é…ç½®}
âœ… æœåŠ¡å°±ç»ª
```

**ç¤ºä¾‹ï¼š**
```python
logger.info("ğŸš€ å¯åŠ¨HTTP Agent Server...")
logger.info(f"ğŸ§  LLMç«¯ç‚¹: {llm_endpoint}")
logger.info(f"ğŸ”§ å¯ç”¨å·¥å…·: {get_tool_names()}")
logger.info(f"ğŸŒ æœåŠ¡å°†åœ¨ http://{host}:{port} å¯åŠ¨")
logger.info("âœ… æœåŠ¡å°±ç»ª")
```

#### 4.3.2 è¯·æ±‚å¤„ç†æ—¥å¿—

**æ ¼å¼ï¼š**
```
-> æ”¶åˆ°{è¯·æ±‚ç±»å‹}è¯·æ±‚: {å…³é”®å‚æ•°}
   å¤„ç†ä¸­...
<- å“åº”: {ç»“æœæ‘˜è¦}
```

**ç¤ºä¾‹ï¼š**
```python
logger.info(f"-> æ”¶åˆ°ASRè¯·æ±‚ï¼ŒéŸ³é¢‘å¤§å°: {len(audio_data)} å­—èŠ‚")
logger.info("<- ASRè¯†åˆ«å®Œæˆï¼Œç»“æœ: 'å»åŠå…¬å®¤æ‹¿æ°´ç“¶'")
```

#### 4.3.3 ä»»åŠ¡æ‰§è¡Œæ—¥å¿—

**æ ¼å¼ï¼š**
```
ğŸ¯ å¼€å§‹æ‰§è¡Œ: {ä»»åŠ¡åç§°}
  æ­¥éª¤1: {æ­¥éª¤æè¿°}
  æ­¥éª¤2: {æ­¥éª¤æè¿°}
  ...
âœ… ä»»åŠ¡å®Œæˆ / âŒ ä»»åŠ¡å¤±è´¥: {åŸå› }
```

**ç¤ºä¾‹ï¼š**
```python
logger.info("ğŸ¯ å¼€å§‹æ‰§è¡Œæ‹¿æ°´ç“¶ä»»åŠ¡")
logger.info("  æ­¥éª¤1: æ¾å¼€å¤¹çˆª")
logger.info("  æ­¥éª¤2: æœºæ¢°è‡‚ç§»åŠ¨åˆ°æŠ“å–ä½ç½®")
logger.info("  æ­¥éª¤3: å¤¹çˆªå¤¹å–")
logger.info("  æ­¥éª¤4: æœºæ¢°è‡‚æŠ¬å‡")
logger.info("âœ… ä»»åŠ¡å®Œæˆ")
```

#### 4.3.4 é”™è¯¯æ—¥å¿—

**æ ¼å¼ï¼š**
```
âŒ é”™è¯¯: {é”™è¯¯ç±»å‹}
   ä½ç½®: {æ¨¡å—}.{å‡½æ•°}
   åŸå› : {é”™è¯¯åŸå› }
   è¯¦æƒ…: {è¯¦ç»†ä¿¡æ¯}
   [å †æ ˆ: {å¼‚å¸¸å †æ ˆ}]
```

**ç¤ºä¾‹ï¼š**
```python
try:
    result = call_external_api()
except Exception as e:
    logger.error(f"âŒ APIè°ƒç”¨å¤±è´¥: {e}")
    logger.error(f"   ä½ç½®: voice_services.recognize_audio_with_tencent")
    logger.error(f"   è¯¦æƒ…: {type(e).__name__}: {str(e)}")
    logger.debug(f"   å †æ ˆ: {traceback.format_exc()}")
```

#### 4.3.5 çŠ¶æ€å˜åŒ–æ—¥å¿—

**æ ¼å¼ï¼š**
```
ğŸ“Š çŠ¶æ€æ›´æ–°: {å¯¹è±¡} {æ—§çŠ¶æ€} â†’ {æ–°çŠ¶æ€}
```

**ç¤ºä¾‹ï¼š**
```python
logger.info(f"ğŸ“Š å¯¼èˆªçŠ¶æ€æ›´æ–°: {old_status} â†’ {new_status}")
logger.info(f"ğŸ“Š æœºæ¢°è‡‚è¿è¡ŒçŠ¶æ€: running_status={self.arm_running_status}")
```

#### 4.3.6 æ€§èƒ½ç›‘æ§æ—¥å¿—

**æ ¼å¼ï¼š**
```
â±ï¸ æ€§èƒ½ç»Ÿè®¡: {æ“ä½œåç§°}
   è€—æ—¶: {duration}ms
   [å…¶ä»–æŒ‡æ ‡]
```

**ç¤ºä¾‹ï¼š**
```python
start_time = time.time()
# ... æ‰§è¡Œæ“ä½œ ...
duration = (time.time() - start_time) * 1000
logger.info(f"â±ï¸ ASRè¯†åˆ«è€—æ—¶: {duration:.2f}ms")
```

### 4.4 è¡¨æƒ…ç¬¦å·ä½¿ç”¨è§„èŒƒ

**æ¨èä½¿ç”¨çš„è¡¨æƒ…ç¬¦å·ï¼š**

| ç¬¦å· | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|-----|------|----------|
| ğŸš€ | å¯åŠ¨ | æœåŠ¡/ç¨‹åºå¯åŠ¨ |
| âœ… | æˆåŠŸ | æ“ä½œæˆåŠŸå®Œæˆ |
| âŒ | å¤±è´¥ | æ“ä½œå¤±è´¥/é”™è¯¯ |
| âš ï¸ | è­¦å‘Š | è­¦å‘Šä¿¡æ¯ |
| ğŸ”§ | é…ç½® | é…ç½®ä¿¡æ¯ |
| ğŸ” | æŸ¥è¯¢ | æŸ¥è¯¢/æœç´¢æ“ä½œ |
| ğŸ“Š | çŠ¶æ€ | çŠ¶æ€å˜åŒ– |
| ğŸ—£ï¸ | è¯­éŸ³è¯†åˆ« | ASRè¯†åˆ«ç»“æœ |
| ğŸ¤– | AIå›å¤ | LLMç”Ÿæˆçš„å›å¤ |
| ğŸ”Š | éŸ³é¢‘æ’­æ”¾ | TTSæ’­æ”¾ |
| ğŸ¤ | éŸ³é¢‘è¾“å…¥ | éº¦å…‹é£é‡‡é›† |
| ğŸ¯ | ä»»åŠ¡ | ä»»åŠ¡æ‰§è¡Œ |
| ğŸ§  | æ€è€ƒ | LLMå¤„ç†ä¸­ |
| ğŸ› ï¸ | å·¥å…· | å·¥å…·è°ƒç”¨ |
| ğŸ” | è®¤è¯ | å£°çº¹è®¤è¯ |
| ğŸ“ | æ³¨å†Œ | ç”¨æˆ·æ³¨å†Œ |
| â±ï¸ | æ€§èƒ½ | æ€§èƒ½ç»Ÿè®¡ |
| ğŸŒ | ç½‘ç»œ | ç½‘ç»œæ“ä½œ |

**æ³¨æ„äº‹é¡¹ï¼š**
- è¡¨æƒ…ç¬¦å·åº”æ”¾åœ¨æ—¥å¿—æ¶ˆæ¯å¼€å¤´
- æ¯æ¡æ—¥å¿—æœ€å¤šä½¿ç”¨1ä¸ªè¡¨æƒ…ç¬¦å·
- åœ¨çº¯æ–‡æœ¬ç¯å¢ƒï¼ˆå¦‚æŸäº›ç»ˆç«¯ï¼‰ä¸­å¯èƒ½æ˜¾ç¤ºå¼‚å¸¸ï¼Œå»ºè®®é…ç½®å¯é€‰å¼€å…³

### 4.5 æ•æ„Ÿä¿¡æ¯å¤„ç†

**éœ€è¦è„±æ•çš„ä¿¡æ¯ï¼š**
- APIå¯†é’¥
- ç”¨æˆ·æ ‡è¯†ï¼ˆéƒ¨åˆ†è„±æ•ï¼‰
- IPåœ°å€ï¼ˆå¯é€‰ï¼‰
- éŸ³é¢‘æ•°æ®ï¼ˆè®°å½•é•¿åº¦è€Œéå†…å®¹ï¼‰

**è„±æ•ç¤ºä¾‹ï¼š**
```python
# é”™è¯¯ç¤ºä¾‹ - æ³„éœ²æ•æ„Ÿä¿¡æ¯
logger.info(f"ä½¿ç”¨å¯†é’¥: {SECRET_KEY}")

# æ­£ç¡®ç¤ºä¾‹ - è„±æ•å¤„ç†
logger.info(f"ä½¿ç”¨å¯†é’¥: {SECRET_KEY[:4]}****{SECRET_KEY[-4:]}")
logger.info(f"ç”¨æˆ·ID: user_****{user_id[-4:]}")
logger.info(f"éŸ³é¢‘æ•°æ®: {len(audio_data)} å­—èŠ‚")
```

### 4.6 æ—¥å¿—æ–‡ä»¶ç®¡ç†

#### 4.6.1 æ—¥å¿—è½®è½¬

**é…ç½®ç¤ºä¾‹ï¼š**
```python
from logging.handlers import RotatingFileHandler

handler = RotatingFileHandler(
    'app.log',
    maxBytes=10*1024*1024,  # 10MB
    backupCount=5,           # ä¿ç•™5ä¸ªå¤‡ä»½
    encoding='utf-8'
)
```

**å‘½åè§„èŒƒï¼š**
```
app.log          # å½“å‰æ—¥å¿—
app.log.1        # ç¬¬ä¸€ä¸ªå¤‡ä»½
app.log.2        # ç¬¬äºŒä¸ªå¤‡ä»½
...
```

#### 4.6.2 æ—¥å¿—åˆ†ç±»

**å»ºè®®æŒ‰æ¨¡å—åˆ†ç¦»æ—¥å¿—ï¼š**
```
logs/
â”œâ”€â”€ voice_service.log      # è¯­éŸ³æœåŠ¡æ—¥å¿—
â”œâ”€â”€ agent_service.log      # AgentæœåŠ¡æ—¥å¿—
â”œâ”€â”€ pipeline.log           # è¯­éŸ³ç›‘å¬æ—¥å¿—
â”œâ”€â”€ mqtt_manager.log       # MQTTç®¡ç†æ—¥å¿—
â””â”€â”€ robot_tools.log        # å·¥å…·è°ƒç”¨æ—¥å¿—
```

### 4.7 å„æ¨¡å—æ—¥å¿—ç¤ºä¾‹

#### 4.7.1 pipeline.py æ—¥å¿—ç¤ºä¾‹

```python
# å¯åŠ¨
logger.info("=" * 50)
logger.info("ğŸ¤ è¯­éŸ³ç›‘å¬å®¢æˆ·ç«¯å¯åŠ¨")
logger.info(f"ğŸ” å£°çº¹è®¤è¯: {'å¼€å¯' if ENABLE_SPEAKER_AUTH else 'å…³é—­'}")
logger.info("=" * 50)

# VADæ£€æµ‹
logger.info(">>> æ£€æµ‹åˆ°è¯­éŸ³")
logger.info(f"  -> æ•è·åˆ°ä¸€æ®µè¯­éŸ³ï¼Œæ—¶é•¿: {duration:.2f} ç§’")

# ASRè¯†åˆ«
logger.info("ğŸ¤ æ­£åœ¨è¿›è¡Œè¯­éŸ³è¯†åˆ«...")
logger.info(f"ğŸ—£ï¸ è¯†åˆ«ç»“æœ: {recognized_text}")

# å£°çº¹è®¤è¯
logger.info("-> æ­£åœ¨è¿›è¡Œè¯´è¯äººè®¤è¯...")
logger.info(f"âœ… è®¤è¯é€šè¿‡: {name} (ç½®ä¿¡åº¦: {conf:.2f})")
logger.warning("ğŸ”’ æœªæ³¨å†Œç”¨æˆ·ï¼Œæ‹’ç»å¤„ç†")

# LLMå¤„ç†
logger.info("ğŸ§  æ€è€ƒä¸­...")
logger.info(f"ğŸ¤– å›å¤: {reply}")

# TTSæ’­æ”¾
logger.info("ğŸ”Š æ’­æ”¾å›å¤ä¸­...")
```

#### 4.7.2 voice_services.py æ—¥å¿—ç¤ºä¾‹

```python
# å¯åŠ¨
logger.info(f"ğŸš€ å¯åŠ¨è¯­éŸ³æœåŠ¡èŠ‚ç‚¹ (host={host}, port={port})...")

# ASRè¯·æ±‚
logger.info("-> ASR æ¥æ”¶åˆ° Base64 éŸ³é¢‘æ•°æ®ï¼Œæ­£åœ¨è§£ç ...")
logger.info(f"-> ASR è§£ç å®Œæˆï¼ŒéŸ³é¢‘æ•°æ®å¤§å°: {len(audio_data)} å­—èŠ‚")
logger.info("ğŸ”„ æ­£åœ¨è°ƒç”¨ ASR...")
logger.info("âœ… ASR è¯†åˆ«å®Œæˆ.")

# TTSè¯·æ±‚
logger.info(f"-> è°ƒç”¨ TTS: '{text[:30]}{'...' if len(text) > 30 else ''}'")
logger.info("<- TTS åˆæˆå®Œæˆ.")

# å£°çº¹æ³¨å†Œ
logger.info(f"-> æ­£åœ¨æ³¨å†Œç”¨æˆ· {user_id} çš„å£°çº¹...")
logger.info(f"âœ… ç”¨æˆ· {user_id} å£°çº¹æ³¨å†ŒæˆåŠŸ")

# é”™è¯¯
logger.error(f"âŒ ASR SDK é”™è¯¯: {err}")
logger.error(f"âŒ TTS å…¶ä»–é”™è¯¯: {e}")
```

#### 4.7.3 http_agent_server.py æ—¥å¿—ç¤ºä¾‹

```python
# å¯åŠ¨
logger.info("ğŸš€ å¯åŠ¨HTTP Agent Server...")
logger.info(f"ğŸ§  LLMç«¯ç‚¹: {llm_endpoint}")
logger.info(f"ğŸ”§ å¯ç”¨å·¥å…·: {get_tool_names()}")

# è¯·æ±‚å¤„ç†
logger.info(f"æ”¶åˆ°è¯·æ±‚ - Prompt: {prompt[:100]}...")
logger.info("è¯·æ±‚å¤„ç†æˆåŠŸ")

# å·¥å…·è°ƒç”¨
logger.info(f"ğŸ› ï¸ å·¥å…· {tool_name} å¼€å§‹æ‰§è¡Œï¼Œè¾“å…¥: {safe_input}")
logger.info(f"âœ… å·¥å…·æ‰§è¡Œå®Œæˆï¼Œè¿”å›å€¼: {text}")
logger.error(f"âŒ å·¥å…·æ‰§è¡Œå‡ºé”™: {error}")

# é”™è¯¯
logger.error(f"Agentå¤„ç†å‡ºé”™: {e}")
```

#### 4.7.4 robot_tools.py æ—¥å¿—ç¤ºä¾‹

```python
# MQTTè¿æ¥
logger.debug("MQTTè¿æ¥æˆåŠŸ")
logger.error(f"MQTTè¿æ¥å¤±è´¥: {e}")

# æŒ‡ä»¤å‘é€
logger.debug(f"å‘é€å¯¼èˆªæŒ‡ä»¤: {topic} â†’ {payload_str}")
logger.debug("å‘å¸ƒæˆåŠŸ")
logger.warning("å‘å¸ƒè¶…æ—¶")

# ä»»åŠ¡æ‰§è¡Œ
logger.info("å¼€å§‹æ‰§è¡Œæ‹¿æ°´ç“¶ä»»åŠ¡...")
logger.info("æ­¥éª¤1: å¯¼èˆªåˆ°æŒ‡å®šåœ°ç‚¹")
logger.info(f"å·²å‘é€å¯¼èˆªæŒ‡ä»¤: ({NAV_X}, {NAV_Y}, {NAV_Z})")
logger.info("æ‹¿æ°´ç“¶ä»»åŠ¡å®Œæˆ")
```

#### 4.7.5 mqtt_manager.py æ—¥å¿—ç¤ºä¾‹

```python
# å¯åŠ¨
rospy.loginfo("å¯åŠ¨MQTTå¯¼èˆªæŒ‡ä»¤æ¥æ”¶å™¨")
rospy.loginfo(f"ç›®æ ‡Broker: {MQTT_BROKER}:{MQTT_PORT}")
rospy.loginfo("ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå™¨å·²å¯åŠ¨")

# MQTTè¿æ¥
rospy.loginfo(f"æˆåŠŸè¿æ¥åˆ°MQTT Broker: {MQTT_BROKER}:{MQTT_PORT}")
rospy.logerr(f"è¿æ¥å¤±è´¥ï¼Œé”™è¯¯ç : {rc}")

# ä»»åŠ¡é˜Ÿåˆ—
rospy.loginfo(f"ä»»åŠ¡å·²åŠ å…¥é˜Ÿåˆ—: {task}, å½“å‰é˜Ÿåˆ—é•¿åº¦: {len(self.task_queue)}")
rospy.loginfo(f"å¼€å§‹æ‰§è¡Œä»»åŠ¡: {self.current_task}, å‰©ä½™ä»»åŠ¡: {len(self.task_queue)}")
rospy.loginfo(f"ä»»åŠ¡å®Œæˆ: {self.current_task}")

# çŠ¶æ€æ›´æ–°
rospy.loginfo(f"å¯¼èˆªçŠ¶æ€æ›´æ–°: {old_status} â†’ {new_status}")
rospy.loginfo(f"æœºæ¢°è‡‚è¿è¡ŒçŠ¶æ€æ›´æ–°: running_status={self.arm_running_status}")

# å¼‚å¸¸å¤„ç†
rospy.logerr("å¯¼èˆªå¼‚å¸¸! ç»ˆæ­¢å½“å‰ä»»åŠ¡å¹¶æš‚åœä»»åŠ¡é˜Ÿåˆ—")
rospy.logwarn("æ£€æµ‹åˆ°æ‰‹æŸ„æ§åˆ¶æ¨¡å¼! ç»ˆæ­¢å½“å‰ä»»åŠ¡å¹¶æš‚åœä»»åŠ¡é˜Ÿåˆ—")
```

---

## 5. é”™è¯¯ç è§„èŒƒ

### 5.1 é”™è¯¯ç è®¾è®¡åŸåˆ™

1. **åˆ†ç±»æ¸…æ™°**ï¼šæŒ‰æ¨¡å—/åŠŸèƒ½åˆ†ç±»
2. **å”¯ä¸€æ€§**ï¼šæ¯ä¸ªé”™è¯¯æœ‰å”¯ä¸€æ ‡è¯†
3. **å¯è¯»æ€§**ï¼šé‡‡ç”¨è¯­ä¹‰åŒ–å‘½å
4. **å¯æ‰©å±•**ï¼šé¢„ç•™æ‰©å±•ç©ºé—´

### 5.2 é”™è¯¯ç æ ¼å¼

**æ ¼å¼ï¼š** `{æ¨¡å—å‰ç¼€}_{é”™è¯¯ç±»å‹}_{åºå·}`

**ç¤ºä¾‹ï¼š**
- `ASR_SERVICE_ERROR_001` - ASRæœåŠ¡é”™è¯¯001
- `TTS_INVALID_PARAM_002` - TTSå‚æ•°é”™è¯¯002
- `MQTT_CONNECTION_ERROR_001` - MQTTè¿æ¥é”™è¯¯001

### 5.3 é”™è¯¯ç æ¸…å•

#### 5.3.1 è¯­éŸ³æœåŠ¡é”™è¯¯ç  (voice_services.py)

**ASRç›¸å…³ï¼ˆASR_xxxï¼‰ï¼š**

| é”™è¯¯ç  | åç§° | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|-------|------|-----------|------|
| ASR_MISSING_AUDIO | ç¼ºå°‘éŸ³é¢‘æ•°æ® | 400 | è¯·æ±‚ä¸­æœªæä¾›audio_base64å­—æ®µ |
| ASR_DECODE_ERROR | Base64è§£ç å¤±è´¥ | 400 | éŸ³é¢‘æ•°æ®Base64è§£ç å¤±è´¥ |
| ASR_INVALID_FORMAT | éŸ³é¢‘æ ¼å¼é”™è¯¯ | 400 | éŸ³é¢‘æ ¼å¼ä¸ç¬¦åˆè¦æ±‚ |
| ASR_SERVICE_ERROR | ASRæœåŠ¡è°ƒç”¨å¤±è´¥ | 500 | è…¾è®¯äº‘ASR APIè°ƒç”¨å¤±è´¥ |
| ASR_TIMEOUT | ASRè¶…æ—¶ | 504 | è¯†åˆ«è¯·æ±‚è¶…æ—¶ |

**TTSç›¸å…³ï¼ˆTTS_xxxï¼‰ï¼š**

| é”™è¯¯ç  | åç§° | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|-------|------|-----------|------|
| TTS_MISSING_TEXT | ç¼ºå°‘æ–‡æœ¬ | 400 | è¯·æ±‚ä¸­æœªæä¾›textå­—æ®µ |
| TTS_EMPTY_TEXT | æ–‡æœ¬ä¸ºç©º | 400 | textå­—æ®µä¸ºç©ºå­—ç¬¦ä¸² |
| TTS_INVALID_CODEC | ä¸æ”¯æŒçš„ç¼–ç æ ¼å¼ | 400 | codecå‚æ•°å€¼æ— æ•ˆ |
| TTS_SERVICE_ERROR | TTSæœåŠ¡è°ƒç”¨å¤±è´¥ | 500 | è…¾è®¯äº‘TTS APIè°ƒç”¨å¤±è´¥ |
| TTS_TIMEOUT | TTSè¶…æ—¶ | 504 | åˆæˆè¯·æ±‚è¶…æ—¶ |

**å£°çº¹è¯†åˆ«ç›¸å…³ï¼ˆSPEAKER_xxxï¼‰ï¼š**

| é”™è¯¯ç  | åç§° | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|-------|------|-----------|------|
| SPEAKER_MISSING_ID | ç¼ºå°‘ç”¨æˆ·ID | 400 | æ³¨å†Œæ—¶æœªæä¾›idå­—æ®µ |
| SPEAKER_MISSING_AUDIO | ç¼ºå°‘éŸ³é¢‘ | 400 | æœªæä¾›audio_base64å­—æ®µ |
| SPEAKER_DUPLICATE_ID | ç”¨æˆ·IDå·²å­˜åœ¨ | 409 | æ³¨å†Œçš„ç”¨æˆ·IDå·²è¢«ä½¿ç”¨ |
| SPEAKER_FEATURE_ERROR | ç‰¹å¾æå–å¤±è´¥ | 500 | å£°çº¹ç‰¹å¾æå–è¿‡ç¨‹å‡ºé”™ |
| SPEAKER_DB_ERROR | æ•°æ®åº“é”™è¯¯ | 500 | å£°çº¹æ•°æ®åº“è¯»å†™é”™è¯¯ |
| SPEAKER_MODEL_ERROR | æ¨¡å‹åŠ è½½å¤±è´¥ | 500 | WeSpeakeræ¨¡å‹åŠ è½½å¤±è´¥ |

#### 5.3.2 AI Agenté”™è¯¯ç  (http_agent_server.py)

**Agentç›¸å…³ï¼ˆAGENT_xxxï¼‰ï¼š**

| é”™è¯¯ç  | åç§° | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|-------|------|-----------|------|
| AGENT_MISSING_PROMPT | ç¼ºå°‘æç¤ºè¯ | 400 | æœªæä¾›promptå‚æ•° |
| AGENT_MISSING_MESSAGES | ç¼ºå°‘æ¶ˆæ¯ | 400 | æœªæä¾›messageså‚æ•° |
| AGENT_INIT_ERROR | Agentåˆå§‹åŒ–å¤±è´¥ | 500 | LangChain Agentåˆå§‹åŒ–å¤±è´¥ |
| AGENT_INVOKE_ERROR | Agentè°ƒç”¨å¤±è´¥ | 500 | Agentæ‰§è¡Œè¿‡ç¨‹å‡ºé”™ |
| AGENT_TOOL_ERROR | å·¥å…·è°ƒç”¨å¤±è´¥ | 500 | å·¥å…·æ‰§è¡Œè¿‡ç¨‹å‡ºé”™ |
| AGENT_LLM_ERROR | LLMæ¨ç†å¤±è´¥ | 500 | å¤§æ¨¡å‹æ¨ç†è¿‡ç¨‹å‡ºé”™ |
| AGENT_TIMEOUT | Agentè¶…æ—¶ | 504 | Agentæ‰§è¡Œè¶…æ—¶ |

#### 5.3.3 æœºå™¨äººæ§åˆ¶é”™è¯¯ç  (robot_tools.py)

**MQTTç›¸å…³ï¼ˆMQTT_xxxï¼‰ï¼š**

| é”™è¯¯ç  | åç§° | è¯´æ˜ |
|-------|------|------|
| MQTT_CONNECTION_ERROR | MQTTè¿æ¥å¤±è´¥ | æ— æ³•è¿æ¥åˆ°MQTT Broker |
| MQTT_PUBLISH_ERROR | æ¶ˆæ¯å‘å¸ƒå¤±è´¥ | MQTTæ¶ˆæ¯å‘å¸ƒå¤±è´¥ |
| MQTT_TIMEOUT | å‘å¸ƒè¶…æ—¶ | æ¶ˆæ¯å‘å¸ƒè¶…æ—¶ |

**å·¥å…·æ‰§è¡Œç›¸å…³ï¼ˆTOOL_xxxï¼‰ï¼š**

| é”™è¯¯ç  | åç§° | è¯´æ˜ |
|-------|------|------|
| TOOL_INVALID_PARAM | å‚æ•°é”™è¯¯ | å·¥å…·å‚æ•°ä¸ç¬¦åˆè¦æ±‚ |
| TOOL_EXEC_ERROR | æ‰§è¡Œå¤±è´¥ | å·¥å…·æ‰§è¡Œè¿‡ç¨‹å‡ºé”™ |

#### 5.3.4 ä»»åŠ¡é˜Ÿåˆ—é”™è¯¯ç  (mqtt_manager.py)

**ä»»åŠ¡ç›¸å…³ï¼ˆTASK_xxxï¼‰ï¼š**

| é”™è¯¯ç  | åç§° | è¯´æ˜ |
|-------|------|------|
| TASK_QUEUE_PAUSED | é˜Ÿåˆ—æš‚åœ | ä»»åŠ¡é˜Ÿåˆ—å·²æš‚åœ |
| TASK_INVALID_TYPE | ä»»åŠ¡ç±»å‹é”™è¯¯ | æ— æ•ˆçš„ä»»åŠ¡ç±»å‹ |
| TASK_INVALID_PAYLOAD | è½½è·é”™è¯¯ | ä»»åŠ¡è½½è·æ ¼å¼é”™è¯¯ |
| TASK_EXEC_ERROR | æ‰§è¡Œå¤±è´¥ | ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹å‡ºé”™ |

**å¯¼èˆªç›¸å…³ï¼ˆNAV_xxxï¼‰ï¼š**

| é”™è¯¯ç  | åç§° | è¯´æ˜ |
|-------|------|------|
| NAV_ABNORMAL | å¯¼èˆªå¼‚å¸¸ | å¯¼èˆªçŠ¶æ€å¼‚å¸¸ |
| NAV_MANUAL_MODE | æ‰‹æŸ„æ§åˆ¶æ¨¡å¼ | æœºå™¨äººå¤„äºæ‰‹æŸ„æ§åˆ¶æ¨¡å¼ |

---

## 6. æœ€ä½³å®è·µ

### 6.1 æ¥å£è®¾è®¡æœ€ä½³å®è·µ

1. **ç‰ˆæœ¬ç®¡ç†**
   - APIè·¯å¾„åŒ…å«ç‰ˆæœ¬å·ï¼š`/v1/completions`
   - ä¿æŒå‘åå…¼å®¹æ€§
   - åºŸå¼ƒçš„æ¥å£åº”ä¿ç•™è‡³å°‘ä¸€ä¸ªå¤§ç‰ˆæœ¬å‘¨æœŸ

2. **å‚æ•°éªŒè¯**
   - æœåŠ¡ç«¯å¿…é¡»éªŒè¯æ‰€æœ‰è¾“å…¥å‚æ•°
   - å‚æ•°é”™è¯¯åº”è¿”å›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯
   - æä¾›å‚æ•°èŒƒå›´å’Œæ ¼å¼è¯´æ˜

3. **å¹‚ç­‰æ€§**
   - GETè¯·æ±‚å¿…é¡»å¹‚ç­‰
   - PUT/DELETEè¯·æ±‚åº”è¯¥å¹‚ç­‰
   - POSTè¯·æ±‚å¯ä»¥éå¹‚ç­‰ï¼ˆå¦‚æ³¨å†Œï¼‰

4. **è¶…æ—¶è®¾ç½®**
   - è®¾ç½®åˆç†çš„è¯·æ±‚è¶…æ—¶æ—¶é—´
   - é•¿æ—¶é—´æ“ä½œè€ƒè™‘å¼‚æ­¥å¤„ç†
   - æä¾›è¶…æ—¶é…ç½®é€‰é¡¹

5. **é”™è¯¯å“åº”**
   - æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
   - åŒ…å«é”™è¯¯ç å’Œé”™è¯¯æè¿°
   - é¿å…æš´éœ²æ•æ„Ÿä¿¡æ¯

### 6.2 æ—¥å¿—è®°å½•æœ€ä½³å®è·µ

1. **æ—¥å¿—çº§åˆ«é€‰æ‹©**
   - DEBUG: ä»…å¼€å‘è°ƒè¯•æ—¶å¯ç”¨
   - INFO: è®°å½•å…³é”®æ“ä½œå’ŒçŠ¶æ€å˜åŒ–
   - WARNING: è®°å½•æ½œåœ¨é—®é¢˜
   - ERROR: è®°å½•é”™è¯¯ä½†ç¨‹åºç»§ç»­è¿è¡Œ
   - CRITICAL: è®°å½•å¯¼è‡´ç¨‹åºå´©æºƒçš„é”™è¯¯

2. **æ—¥å¿—å†…å®¹**
   - åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
   - ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—ï¼ˆJSONæ ¼å¼ï¼‰
   - è®°å½•è¯·æ±‚IDä¾¿äºè¿½è¸ª
   - é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯

3. **æ€§èƒ½è€ƒè™‘**
   - é¿å…åœ¨é«˜é¢‘å¾ªç¯ä¸­ä½¿ç”¨INFOçº§åˆ«æ—¥å¿—
   - å¤§æ•°æ®å¯¹è±¡åªè®°å½•æ‘˜è¦ä¿¡æ¯
   - ä½¿ç”¨å¼‚æ­¥æ—¥å¿—é¿å…é˜»å¡

4. **æ—¥å¿—ç®¡ç†**
   - å®æ–½æ—¥å¿—è½®è½¬ç­–ç•¥
   - å®šæœŸå½’æ¡£æˆ–æ¸…ç†æ—§æ—¥å¿—
   - è€ƒè™‘é›†ä¸­å¼æ—¥å¿—ç®¡ç†ï¼ˆå¦‚ELKï¼‰

### 6.3 ç›‘æ§å’Œå‘Šè­¦

#### 6.3.1 å…³é”®æŒ‡æ ‡ç›‘æ§

**æœåŠ¡å¥åº·æŒ‡æ ‡ï¼š**
- HTTPè¯·æ±‚æˆåŠŸç‡
- å¹³å‡å“åº”æ—¶é—´
- å¹¶å‘è¿æ¥æ•°
- é”™è¯¯ç‡ï¼ˆæŒ‰é”™è¯¯ç ç»Ÿè®¡ï¼‰

**ä¸šåŠ¡æŒ‡æ ‡ï¼š**
- ASRè¯†åˆ«æˆåŠŸç‡
- TTSåˆæˆæˆåŠŸç‡
- å£°çº¹è®¤è¯é€šè¿‡ç‡
- å·¥å…·è°ƒç”¨æˆåŠŸç‡
- ä»»åŠ¡å®Œæˆç‡

**ç³»ç»ŸæŒ‡æ ‡ï¼š**
- CPUä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ä½¿ç”¨ç‡
- ç½‘ç»œæµé‡

#### 6.3.2 å‘Šè­¦è§„åˆ™

**å»ºè®®å‘Šè­¦é˜ˆå€¼ï¼š**
- é”™è¯¯ç‡ > 5%ï¼šè­¦å‘Š
- é”™è¯¯ç‡ > 10%ï¼šä¸¥é‡
- å“åº”æ—¶é—´ > 5sï¼šè­¦å‘Š
- å“åº”æ—¶é—´ > 10sï¼šä¸¥é‡
- æœåŠ¡ä¸å¯ç”¨ï¼šä¸¥é‡

---

## 7. æµ‹è¯•è§„èŒƒ

### 7.1 æ¥å£æµ‹è¯•

#### 7.1.1 ASRæ¥å£æµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹1ï¼šæ­£å¸¸è¯†åˆ«**
```bash
curl -X POST http://202.38.214.151:4999/asr/recognize \
  -H "Content-Type: application/json" \
  -d '{
    "audio_base64": "'$(base64 -w 0 test.wav)'"
  }'
```

**é¢„æœŸç»“æœï¼š**
```json
{
  "success": true,
  "result": "å»åŠå…¬å®¤æ‹¿æ°´ç“¶"
}
```

**æµ‹è¯•ç”¨ä¾‹2ï¼šç¼ºå°‘å‚æ•°**
```bash
curl -X POST http://202.38.214.151:4999/asr/recognize \
  -H "Content-Type: application/json" \
  -d '{}'
```

**é¢„æœŸç»“æœï¼š**
```json
{
  "success": false,
  "error": "ç¼ºå°‘ 'audio_base64' å­—æ®µ"
}
```

#### 7.1.2 TTSæ¥å£æµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹1ï¼šæ­£å¸¸åˆæˆ**
```bash
curl -X POST http://202.38.214.151:4999/tts/synthesize \
  -H "Content-Type: application/json" \
  -d '{
    "text": "ä½ å¥½ï¼Œæˆ‘æ˜¯æ™ºèƒ½æœºå™¨äºº"
  }'
```

**é¢„æœŸç»“æœï¼š**
```json
{
  "success": true,
  "audio_base64": "UklGRi..."
}
```

#### 7.1.3 Agentæ¥å£æµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹1ï¼šç®€å•å¯¹è¯**
```bash
curl -X POST http://202.38.214.151:5000/v1/completions \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Human: ä½ å¥½\nAssistant:",
    "stop": ["Human:", "Assistant:"]
  }'
```

**æµ‹è¯•ç”¨ä¾‹2ï¼šå·¥å…·è°ƒç”¨**
```bash
curl -X POST http://202.38.214.151:5000/v1/completions \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Human: å»åŠå…¬å®¤\nAssistant:"
  }'
```

### 7.2 MQTTæµ‹è¯•

#### 7.2.1 å‘å¸ƒå¯¼èˆªæŒ‡ä»¤

```bash
mosquitto_pub -h 10.194.142.104 -p 1883 -t robot/navigation \
  -q 1 -m '{"x": 74.814, "y": 77.791, "z": 0.0}'
```

#### 7.2.2 å‘å¸ƒæœºæ¢°è‡‚æŒ‡ä»¤

```bash
mosquitto_pub -h 10.194.142.104 -p 1883 -t robot/arm/control \
  -q 1 -m '{"command": 0}'
```

#### 7.2.3 è®¢é˜…æ‰€æœ‰ä¸»é¢˜

```bash
mosquitto_sub -h 127.0.0.1 -p 1883 -t 'robot/#' -v
```

---

## 8. é™„å½•

### 8.1 å®Œæ•´é…ç½®ç¤ºä¾‹

**voice_services.py é…ç½®**
```bash
export TENCENTCLOUD_SECRET_ID="AKIDxxxxxxxxxxxx"
export TENCENTCLOUD_SECRET_KEY="xxxxxxxxxxxx"
export SPEAKER_MODEL_DIR="/home/lxc/.wespeaker/chinese"
export SPEAKER_DB_DIR="./speaker_db"
export SPEAKER_THRESHOLD="0.62"
export SPEAKER_DEVICE="cuda:0"
export FLASK_HOST="0.0.0.0"
export FLASK_PORT="4999"
```

**http_agent_server.py å¯åŠ¨**
```bash
python http_agent_server.py \
  --host 0.0.0.0 \
  --port 5000 \
  --llm-endpoint http://localhost:8000/v1
```

**pipeline.py é…ç½®**
```python
VOICE_SERVER_IP = "202.38.214.151"
VOICE_SERVER_PORT = 4999
LLM_SERVER_IP = "202.38.214.151"
LLM_SERVER_PORT = 5000
ENABLE_SPEAKER_AUTH = "false"
```

### 8.2 å·¥å…·æ¸…å•

| å·¥å…·å | åŠŸèƒ½ | MQTTä¸»é¢˜ |
|-------|------|----------|
| go_to_office | å¯¼èˆªåˆ°åŠå…¬å®¤ | robot/navigation |
| go_to_restroom | å¯¼èˆªåˆ°ä¼‘æ¯å®¤ | robot/navigation |
| go_to_corridor | å¯¼èˆªåˆ°èµ°å»Š | robot/navigation |
| arm_control | æœºæ¢°è‡‚æ§åˆ¶ | robot/arm/control |
| arm_control_coordinate | æœºæ¢°è‡‚åæ ‡æ§åˆ¶ | robot/arm/coordinate |
| gripper_control | å¤¹çˆªæ§åˆ¶ | robot/gripper/control |
| complex_task | ç»„åˆä»»åŠ¡ | å¤šä¸ªä¸»é¢˜ |
| get_water_bottle | æ‹¿æ°´ç“¶ä»»åŠ¡ | å¤šä¸ªä¸»é¢˜ |

### 8.3 å‚è€ƒé“¾æ¥

- [Flaskæ–‡æ¡£](https://flask.palletsprojects.com/)
- [LangChainæ–‡æ¡£](https://python.langchain.com/)
- [MQTTåè®®è§„èŒƒ](https://mqtt.org/mqtt-specification/)
- [ROS Wiki](http://wiki.ros.org/)
- [è…¾è®¯äº‘ASRæ–‡æ¡£](https://cloud.tencent.com/document/product/1093)
- [è…¾è®¯äº‘TTSæ–‡æ¡£](https://cloud.tencent.com/document/product/1073)

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025-11-05  
**ç»´æŠ¤è€…ï¼š** AI Agent Team  
**å®¡é˜…çŠ¶æ€ï¼š** âœ… å·²å®¡é˜…

